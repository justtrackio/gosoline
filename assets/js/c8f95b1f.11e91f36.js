"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[5853],{2761(e,n,t){t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>g,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"how-to/logging/implement-a-log-handler","title":"Implement a log handler","description":"With the cfg and log packages, you can implement a handler and make it available via config.","source":"@site/docs/how-to/logging/implement-a-log-handler.mdx","sourceDirName":"how-to/logging","slug":"/how-to/logging/implement-a-log-handler","permalink":"/gosoline/how-to/logging/implement-a-log-handler","draft":false,"unlisted":false,"editUrl":"https://github.com/justtrackio/gosoline/tree/main/docs/docs/how-to/logging/implement-a-log-handler.mdx","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Implement a log handler"},"sidebar":"docSidebar","previous":{"title":"Use context with logs","permalink":"/gosoline/how-to/logging/log-context"},"next":{"title":"Notes on general Kafka usage","permalink":"/gosoline/how-to/kafka/general"}}');var l=t(4848),o=t(8453),i=t(3457);const a={sidebar_position:6,title:"Implement a log handler"},s=void 0,d={},c=[{value:"Before you begin",id:"before-you-begin",level:2},{value:"Implement your custom log handler",id:"implement-your-custom-log-handler",level:2},{value:"Import your gosoline dependencies",id:"import-your-gosoline-dependencies",level:3},{value:"Create a settings struct",id:"create-a-settings-struct",level:3},{value:"Create a new handler",id:"create-a-new-handler",level:3},{value:"Implement the <code>ChannelLevel</code> method",id:"implement-the-channellevel-method",level:3},{value:"Implement the <code>Level</code> method",id:"implement-the-level-method",level:3},{value:"Implement the <code>Log</code> method",id:"implement-the-log-method",level:3},{value:"Create a handler factory",id:"create-a-handler-factory",level:3},{value:"Add your handler factory",id:"add-your-handler-factory",level:3},{value:"Conclusion",id:"conclusion",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.p,{children:["With the ",(0,l.jsx)(n.code,{children:"cfg"})," and ",(0,l.jsx)(n.code,{children:"log"})," packages, you can implement a handler and make it available via config."]}),"\n",(0,l.jsx)(n.h2,{id:"before-you-begin",children:"Before you begin"}),"\n",(0,l.jsx)(n.p,{children:"Here is a preview of all the code you'll cover in this guide:"}),"\n",(0,l.jsxs)(t,{children:[(0,l.jsx)("summary",{children:"main.go"}),(0,l.jsx)("p",{children:(0,l.jsx)(i.A,{showLineNumbers:!0,language:"go",children:'package main\n\nimport (\n\t"context"\n\t"fmt"\n\t"time"\n\n\t"github.com/justtrackio/gosoline/pkg/cfg"\n\t"github.com/justtrackio/gosoline/pkg/log"\n\t"github.com/justtrackio/gosoline/pkg/mdl"\n)\n\ntype MyCustomHandlerSettings struct {\n\tChannel string `cfg:"channel"`\n}\n\ntype MyCustomHandler struct {\n\tchannel string\n}\n\nfunc (h *MyCustomHandler) ChannelLevel(name string) (level *int, err error) {\n\tif name == h.channel {\n\t\treturn mdl.Box(log.PriorityDebug), nil\n\t}\n\n\treturn nil, nil\n}\n\nfunc (h *MyCustomHandler) Level() int {\n\treturn log.PriorityInfo\n}\n\nfunc (h *MyCustomHandler) Log(ctx context.Context, timestamp time.Time, level int, msg string, args []any, err error, data log.Data) error {\n\tfmt.Printf("%s happened at %s", msg, timestamp.Format(time.RFC822))\n\n\treturn nil\n}\n\nfunc MyCustomHandlerFactory(config cfg.Config, name string) (log.Handler, error) {\n\tsettings := &MyCustomHandlerSettings{}\n\tif err := log.UnmarshalHandlerSettingsFromConfig(config, name, settings); err != nil {\n\t\treturn nil, fmt.Errorf("can not unmarshal handler settings: %w", err)\n\t}\n\n\treturn &MyCustomHandler{\n\t\tchannel: settings.Channel,\n\t}, nil\n}\n\nfunc main() {\n\tlog.AddHandlerFactory("my-custom-handler", MyCustomHandlerFactory)\n}\n'})})]}),"\n",(0,l.jsx)(n.h2,{id:"implement-your-custom-log-handler",children:"Implement your custom log handler"}),"\n",(0,l.jsx)(n.h3,{id:"import-your-gosoline-dependencies",children:"Import your gosoline dependencies"}),"\n",(0,l.jsx)(n.p,{children:"Add the following imports to your code:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'import (\n\t"context"\n\t"fmt"\n\t"time"\n\n\t"github.com/justtrackio/gosoline/pkg/cfg"\n\t"github.com/justtrackio/gosoline/pkg/log"\n\t"github.com/justtrackio/gosoline/pkg/mdl"\n)\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Here, you imported some standard dependencies, along with the ",(0,l.jsx)(n.code,{children:"cfg"})," and ",(0,l.jsx)(n.code,{children:"log"})," packages from gosoline."]}),"\n",(0,l.jsx)(n.h3,{id:"create-a-settings-struct",children:"Create a settings struct"}),"\n",(0,l.jsx)(n.p,{children:"Create a struct that stores log settings:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'type MyCustomHandlerSettings struct {\n\tChannel string `cfg:"channel"`\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"cfg:"})," defines the key you'll use to bind the ",(0,l.jsx)(n.code,{children:"channel"})," value from the configuration object to this struct."]}),"\n",(0,l.jsx)(n.h3,{id:"create-a-new-handler",children:"Create a new handler"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:"type MyCustomHandler struct {\n\tchannel string\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["This handler struct stores the log ",(0,l.jsx)(n.code,{children:"channel"}),". To use your handler, you must implement the required methods of the ",(0,l.jsx)(n.a,{href:"/reference/package-log#handler",children:(0,l.jsx)(n.code,{children:"Handler"})})," interface."]}),"\n",(0,l.jsxs)(n.h3,{id:"implement-the-channellevel-method",children:["Implement the ",(0,l.jsx)(n.code,{children:"ChannelLevel"})," method"]}),"\n",(0,l.jsx)(n.p,{children:"Create a function which returns the log level for a given channel name:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:"func (h *MyCustomHandler) ChannelLevel(name string) (level *int, err error) {\n\tif name == h.channel {\n\t\treturn mdl.Box(log.PriorityDebug), nil\n\t}\n\n\treturn nil, nil\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["This checks if the requested channel is the channel we want to override, and, if so, returns a hardcoded value. Otherwise, we return nothing to indicate that the return value of the ",(0,l.jsx)(n.code,{children:"Level"})," method should be used."]}),"\n",(0,l.jsxs)(n.h3,{id:"implement-the-level-method",children:["Implement the ",(0,l.jsx)(n.code,{children:"Level"})," method"]}),"\n",(0,l.jsx)(n.p,{children:"Create a getter for the log priority level:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:"func (h *MyCustomHandler) Level() int {\n\treturn log.PriorityInfo\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"Here, you'll return the info level priority."}),"\n",(0,l.jsxs)(n.h3,{id:"implement-the-log-method",children:["Implement the ",(0,l.jsx)(n.code,{children:"Log"})," method"]}),"\n",(0,l.jsx)(n.p,{children:"Create a getter for the log message:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'func (h *MyCustomHandler) Log(ctx context.Context, timestamp time.Time, level int, msg string, args []any, err error, data log.Data) error {\n\tfmt.Printf("%s happened at %s", msg, timestamp.Format(time.RFC822))\n\n\treturn nil\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Here, you accept, among other things, a ",(0,l.jsx)(n.code,{children:"msg"})," string and a ",(0,l.jsx)(n.code,{children:"timestamp"}),". Then, you print a formatted log message, using these values."]}),"\n",(0,l.jsx)(n.h3,{id:"create-a-handler-factory",children:"Create a handler factory"}),"\n",(0,l.jsx)(n.p,{children:"Create a custom handler factory:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'func MyCustomHandlerFactory(config cfg.Config, name string) (log.Handler, error) {\n\t// 1\n\tsettings := &MyCustomHandlerSettings{}\n\n\t// 2\n\tif err := log.UnmarshalHandlerSettingsFromConfig(config, name, settings); err != nil {\n\t\treturn nil, fmt.Errorf("can not unmarshal handler settings: %w", err)\n\t}\n\n\t// 3\n\treturn &MyCustomHandler{\n\t\tchannel: settings.Channel,\n\t}, nil\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"This accepts a configuration and a name and returns a Handler. You accomplish this with the following steps:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Initialize ",(0,l.jsx)(n.code,{children:"settings"})," to a new, empty ",(0,l.jsx)(n.code,{children:"MyCustomHandlerSettings"})," struct, which you defined in the last step."]}),"\n",(0,l.jsxs)(n.li,{children:["Store the configuration values from the configuration in the ",(0,l.jsx)(n.code,{children:"settings"})," struct."]}),"\n",(0,l.jsxs)(n.li,{children:["Create a new ",(0,l.jsx)(n.code,{children:"MyCustomHandler"}),", using the ",(0,l.jsx)(n.code,{children:"settings.Channel"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"add-your-handler-factory",children:"Add your handler factory"}),"\n",(0,l.jsxs)(n.p,{children:["In ",(0,l.jsx)(n.code,{children:"main()"}),", or wherever is most appropriate for your application, add your custom handler factory:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'log.AddHandlerFactory("my-custom-handler", MyCustomHandlerFactory)\n'})}),"\n",(0,l.jsx)(n.p,{children:'This sets the handler type to "my-custom-handler".'}),"\n",(0,l.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,l.jsx)(n.p,{children:"That's it! In this guide, you:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Implemented a custom Handler."}),"\n",(0,l.jsx)(n.li,{children:"Created a handler factory."}),"\n",(0,l.jsx)(n.li,{children:"Added your factory to the logging configuration."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Check out these resources to learn more about logging with gosoline:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/how-to/logging/use-loggers",children:"Use loggers"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/reference/package-log",children:"API reference for the log package"})}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}}}]);