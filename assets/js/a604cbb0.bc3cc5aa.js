"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[595],{6185(e,t,n){n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"how-to/kafka/use-schema-registry","title":"How to use the Kafka Schema Registry","description":"Gosoline provides the option to use the Kafka schema registry when reading from or writing to a Kafka topic.","source":"@site/docs/how-to/kafka/use-schema-registry.mdx","sourceDirName":"how-to/kafka","slug":"/how-to/kafka/use-schema-registry","permalink":"/gosoline/how-to/kafka/use-schema-registry","draft":false,"unlisted":false,"editUrl":"https://github.com/justtrackio/gosoline/tree/main/docs/docs/how-to/kafka/use-schema-registry.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"How to use the Kafka Schema Registry"},"sidebar":"docSidebar","previous":{"title":"Notes on general Kafka usage","permalink":"/gosoline/how-to/kafka/general"},"next":{"title":"Use sampling","permalink":"/gosoline/how-to/sampling/use-sampling"}}');var s=n(4848),a=n(8453);const i={sidebar_position:2,title:"How to use the Kafka Schema Registry"},o=void 0,c={},h=[{value:"Registering a schema",id:"registering-a-schema",level:2},{value:"Configure a Producer/Publisher to use the schema registry",id:"configure-a-producerpublisher-to-use-the-schema-registry",level:2},{value:"Configure a Consumer to use the schema registry",id:"configure-a-consumer-to-use-the-schema-registry",level:2},{value:"Configure a Subscriber to use the schema registry",id:"configure-a-subscriber-to-use-the-schema-registry",level:2}];function l(e){const t={code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"Gosoline provides the option to use the Kafka schema registry when reading from or writing to a Kafka topic.\nThis will ensure that changes to your schema do not break compatability with the previous schemas according to the specified compatability mode."}),"\n",(0,s.jsx)(t.p,{children:"Using the shema registry is optional and gosoline will let you read and write anything if you choose to."}),"\n",(0,s.jsx)(t.p,{children:"Moreover, keep in mind that the Apache Kafka broker does not have any server side schema validation and will still let you write anything to a topic if you do not configure gosoline to use the schema registry,\neven if there are already existing consumers and producers of that topic which do use the schema registry."}),"\n",(0,s.jsx)(t.h2,{id:"registering-a-schema",children:"Registering a schema"}),"\n",(0,s.jsx)(t.p,{children:"Gosoline itself will not register your schema and expects that any provided schema is already registered, as otherwise your app may crash on runtime when trying to register an incompatible schema."}),"\n",(0,s.jsx)(t.p,{children:"Thus, you will have to externally register every schema that you want to use and check for compatability, e.g. via a CI/CD pipeline."}),"\n",(0,s.jsx)(t.h2,{id:"configure-a-producerpublisher-to-use-the-schema-registry",children:"Configure a Producer/Publisher to use the schema registry"}),"\n",(0,s.jsx)(t.p,{children:"As usual, you need to specify the encoding in your config according to your schema type."}),"\n",(0,s.jsxs)(t.p,{children:["In addition to the already natively supported ",(0,s.jsx)(t.code,{children:"application/json"})," and ",(0,s.jsx)(t.code,{children:"application/x-protobuf"})," encodings, you also have the option to use ",(0,s.jsx)(t.code,{children:"application/avro"})," when using the Kafka schema registry."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"stream:\n  producer:\n    producerName:\n      encoding: application/avro\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Now you need to provide the schema settings via the ",(0,s.jsx)(t.code,{children:"stream.WithSchemaSettings"})," option when creating your Producer/Publisher."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-go",children:'//go:embed ExampleEvent.avsc\nvar exampleEventSchema string\n\nschemaSettings := stream.SchemaSettings{\n    Subject: "exampleEvent",\n    Schema:  exampleEventSchema,\n    Model:   &exampleEvent{},\n}\n\nproducer, err := stream.NewProducer(ctx, config, logger, "producerName", stream.WithSchemaSettings(schemaSettings))\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Where the ",(0,s.jsx)(t.code,{children:"ExampleEvent.avsc"})," file would contain the avro schema."]}),"\n",(0,s.jsxs)(t.p,{children:["Note that depending on whether your model is specified as a struct (",(0,s.jsx)(t.code,{children:"exampleEvent{}"}),") or a pointer to a struct (",(0,s.jsx)(t.code,{children:"&exampleEvent{}"}),") you will also need to write your events accordingly via ",(0,s.jsx)(t.code,{children:"producer.Write"}),"/",(0,s.jsx)(t.code,{children:"producer.WriteOne"}),"\nbecause the internal serializer of the franz-go kafka library will otherwise complain that there is no registered encoder for your model if you mix it up."]}),"\n",(0,s.jsx)(t.h2,{id:"configure-a-consumer-to-use-the-schema-registry",children:"Configure a Consumer to use the schema registry"}),"\n",(0,s.jsx)(t.p,{children:"Configure the encoding in your config."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"stream:\n  consumer:\n    default:\n      encoding: application/avro\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Like the producer, the consumer needs to provide the schema settings but the consumer has to do this by implementing the ",(0,s.jsx)(t.code,{children:"stream.SchemaSettingsAwareCallback"})," interface,\ni.e. by implementing the ",(0,s.jsx)(t.code,{children:"GetSchemaSettings()"})," method."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-go",children:'func (c consumer) GetSchemaSettings() (*stream.SchemaSettings, error) {\n\treturn &stream.SchemaSettings{\n        Subject: "exampleEvent",\n        Schema:  exampleEventSchema,\n        Model:   &exampleEvent{},\n    }, nil\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"configure-a-subscriber-to-use-the-schema-registry",children:"Configure a Subscriber to use the schema registry"}),"\n",(0,s.jsx)(t.p,{children:"This case works similar to the consumer case."}),"\n",(0,s.jsx)(t.p,{children:"Again configure the encoding in your config."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"mdlsub:\n  subscribers:\n    targetModelName:\n      input: kafka\n      output: ddb\n      source: { group: source-group, name: exampleEvent }\n\nstream:\n  consumer:\n    subscriber-targetModelName:\n      encoding: application/avro\n"})}),"\n",(0,s.jsxs)(t.p,{children:["And again you need to provide the schema settings by implementing the ",(0,s.jsx)(t.code,{children:"stream.SchemaSettingsAwareCallback"})," interface\nbut in this case the interface has to be implemented by your transformer."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-go",children:'func (t transformer) GetSchemaSettings() (*stream.SchemaSettings, error) {\n\treturn &stream.SchemaSettings{\n        Subject: "exampleEvent",\n        Schema:  exampleEventSchema,\n        Model:   &exampleEvent{},\n    }, nil\n}\n'})}),"\n",(0,s.jsx)(t.p,{children:"Note that gosoline will only allow you to have one transformer per model when using the schema registry as proper schema evolution via the registry should make versioning with multiple transformers obsolete."})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);