"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[7002],{2754(e,n,t){t.d(n,{N:()=>y,v:()=>f});t(6540);var r=t(3796),o=t(5430),s=t(4501),i=t(5292),d=t(5433),l=t(6311),a=t(7625),c=t(1662),h=t(6645),u=t(3457),p=t(467),m=t(3865),g=t(5293),x=t(6025),j=t(4848);function f(){const{colorMode:e}=(0,g.G)(),n="dark"===e,t=(0,p.A)({palette:{mode:n?"dark":"light"}});return(0,j.jsx)(m.A,{theme:t,children:(0,j.jsxs)(c.Ay,{container:!0,spacing:4,children:[(0,j.jsx)(c.Ay,{item:!0,xs:12,s:12,md:4,children:(0,j.jsxs)(r.A,{style:{height:"100%"},children:[(0,j.jsx)(s.A,{title:"HTTP Server",avatar:(0,j.jsx)(h.A,{}),titleTypographyProps:{variant:"h6"}}),(0,j.jsx)(i.A,{children:"Build REST web services with HTTP handling, caching, OAuth, and much more."}),(0,j.jsx)(o.A,{children:(0,j.jsx)(d.A,{size:"small",href:(0,x.Ay)("/category/http-server"),children:"Get started"})})]})}),(0,j.jsx)(c.Ay,{item:!0,xs:12,md:4,children:(0,j.jsxs)(r.A,{style:{height:"100%"},children:[(0,j.jsx)(s.A,{title:"Message Queues",avatar:(0,j.jsx)(l.A,{}),titleTypographyProps:{variant:"h6"}}),(0,j.jsx)(i.A,{children:"Process asynchronous messages from Kafka, Redis, or any other queuing or streaming system."}),(0,j.jsx)(o.A,{children:(0,j.jsx)(d.A,{size:"small",href:(0,x.Ay)("/quickstart/create-a-consumer"),children:"Get started"})})]})}),(0,j.jsx)(c.Ay,{item:!0,xs:12,md:4,children:(0,j.jsxs)(r.A,{style:{height:"100%"},children:[(0,j.jsx)(s.A,{title:"Kernel Module",avatar:(0,j.jsx)(a.A,{}),titleTypographyProps:{variant:"h6"}}),(0,j.jsx)(i.A,{children:"Implement a kernel module with which you can do anything, using gosoline's logging, configuration, and other solutions."}),(0,j.jsx)(o.A,{children:(0,j.jsx)(d.A,{size:"small",href:(0,x.Ay)("/quickstart/create-an-application"),children:"Get started"})})]})})]})})}function y({children:e,snippet:n,...t}){let r=e.replace(/\n$/,"");var o=!1;if(n){const e=new RegExp(`(?://|#) snippet-start: ${n}s*(.*)(?://|#) snippet-end: ${n}s*$`,"sm");let t=r.match(e);t&&(r=t[1],o=!0)}return r=r.split("\n").filter(function(e){return!new RegExp("w*?(?://|#) snippet.*\n*?$","g").test(e)}),o&&(r=r.slice(1,-1)),r=r.join("\n"),(0,j.jsx)(u.A,{...t,children:r})}},4405(e,n,t){t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>c,default:()=>m,frontMatter:()=>a,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"quickstart/http-server/write-crud-sql-app","title":"Write a CRUD SQL app","description":"A common REST API structure provides methods for users to create, read, update, and delete (CRUD) resources. In this tutorial, you\'ll:","source":"@site/docs/quickstart/http-server/write-crud-sql-app.mdx","sourceDirName":"quickstart/http-server","slug":"/quickstart/http-server/write-crud-sql-app","permalink":"/gosoline/quickstart/http-server/write-crud-sql-app","draft":false,"unlisted":false,"editUrl":"https://github.com/justtrackio/gosoline/tree/main/docs/docs/quickstart/http-server/write-crud-sql-app.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Write a CRUD SQL app"},"sidebar":"docSidebar","previous":{"title":"Create a money exchange app","permalink":"/gosoline/quickstart/http-server/create-a-money-exchange-app"},"next":{"title":"Create a consumer","permalink":"/gosoline/quickstart/create-a-consumer"}}');var o=t(4848),s=t(8453),i=t(2754);const d='// snippet-start: imports\npackage main\n\nimport (\n\t"context"\n\t"fmt"\n\t"time"\n\n\t"github.com/justtrackio/gosoline/pkg/cfg"\n\t"github.com/justtrackio/gosoline/pkg/db-repo"\n\t"github.com/justtrackio/gosoline/pkg/httpserver/crud"\n\t"github.com/justtrackio/gosoline/pkg/log"\n\t"github.com/justtrackio/gosoline/pkg/mdl"\n)\n\n// snippet-end: imports\n\n// snippet-start: settings\nvar settings = db_repo.Settings{\n\tMetadata: db_repo.Metadata{\n\t\tModelId: mdl.ModelId{\n\t\t\tName: "todo",\n\t\t},\n\t\tTableName:  "todos",\n\t\tPrimaryKey: "todos.id",\n\t},\n}\n\n// snippet-end: settings\n\n// snippet-start: todo\ntype Todo struct {\n\tdb_repo.Model\n\tText    string\n\tDueDate time.Time\n}\n\n// snippet-end: todo\n\n// snippet-start: create and update\ntype CreateInput struct {\n\tText    string    `form:"text"`\n\tDueDate time.Time `form:"dueDate"`\n}\n\ntype UpdateInput struct {\n\tText string `form:"text"`\n}\n\n// snippet-end: create and update\n\n// snippet-start: crud handler\ntype TodoCrudHandlerV0 struct {\n\trepo db_repo.Repository\n}\n\n// snippet-end: crud handler\n\n// snippet-start: todo constructor\nfunc NewTodoCrudHandler(ctx context.Context, config cfg.Config, logger log.Logger) (*TodoCrudHandlerV0, error) {\n\t// Declare `error` and `repo` variables.\n\tvar err error\n\tvar repo db_repo.Repository\n\n\t// Try to create a new `Repository` given a configuration, a logger, and settings. If there is an error, you return it.\n\tif repo, err = db_repo.New(ctx, config, logger, settings); err != nil {\n\t\treturn nil, fmt.Errorf("can not create db_repo.Repositorys: %w", err)\n\t}\n\n\t// Create a new `TodoCrudHandlerV0` with that repo.\n\thandler := &TodoCrudHandlerV0{\n\t\trepo: repo,\n\t}\n\n\t// Return the handler.\n\treturn handler, nil\n}\n\n// snippet-end: todo constructor\n\n// snippet-start: get repo\nfunc (h TodoCrudHandlerV0) GetRepository() crud.Repository {\n\treturn h.repo\n}\n\n// snippet-end: get repo\n\n// snippet-start: get model\nfunc (h TodoCrudHandlerV0) GetModel() db_repo.ModelBased {\n\treturn &Todo{}\n}\n\n// snippet-end: get model\n\n// snippet-start: create input\nfunc (h TodoCrudHandlerV0) GetCreateInput() any {\n\treturn &CreateInput{}\n}\n\n// snippet-end: create input\n\n// snippet-start: transform create\nfunc (h TodoCrudHandlerV0) TransformCreate(ctx context.Context, input any, model db_repo.ModelBased) error {\n\tin := input.(*CreateInput)\n\tm := model.(*Todo)\n\n\tm.Text = in.Text\n\tm.DueDate = in.DueDate\n\n\treturn nil\n}\n\n// snippet-end: transform create\n\n// snippet-start: get update input\nfunc (h TodoCrudHandlerV0) GetUpdateInput() any {\n\treturn &UpdateInput{}\n}\n\n// snippet-end: get update input\n\n// snippet-start: transform update\nfunc (h TodoCrudHandlerV0) TransformUpdate(ctx context.Context, input any, model db_repo.ModelBased) error {\n\tin := input.(*UpdateInput)\n\tm := model.(*Todo)\n\n\tm.Text = in.Text\n\n\treturn nil\n}\n\n// snippet-end: transform update\n\n// snippet-start: transform output\nfunc (h TodoCrudHandlerV0) TransformOutput(ctx context.Context, model db_repo.ModelBased, apiView string) (any, error) {\n\treturn model, nil\n}\n\n// snippet-end: transform output\n\n// snippet-start: list\nfunc (h TodoCrudHandlerV0) List(ctx context.Context, qb *db_repo.QueryBuilder, apiView string) (any, error) {\n\tvar err error\n\n\t// Instatiate a list of Todo objects, called result.\n\tresult := make([]*Todo, 0)\n\n\t// Query the database using a Context and a QueryBuilder. If it finds the results, it sets them on result. Otherwise, it returns an error.\n\tif err = h.repo.Query(ctx, qb, &result); err != nil {\n\t\treturn nil, fmt.Errorf("can not query todo items: %w", err)\n\t}\n\n\t// Transform each result with TransformOutput().\n\tout := make([]any, len(result))\n\tfor i, res := range result {\n\t\tif out[i], err = h.TransformOutput(ctx, res, apiView); err != nil {\n\t\t\treturn nil, err\n\t\t}\n\t}\n\n\t// Return the transformed results.\n\treturn out, nil\n}\n\n// snippet-end: list\n',l='// snippet-start: imports\npackage main\n\nimport (\n\t"context"\n\t"fmt"\n\n\t"github.com/justtrackio/gosoline/pkg/application"\n\t"github.com/justtrackio/gosoline/pkg/cfg"\n\t"github.com/justtrackio/gosoline/pkg/httpserver"\n\t"github.com/justtrackio/gosoline/pkg/httpserver/crud"\n\t"github.com/justtrackio/gosoline/pkg/log"\n)\n\n// snippet-end: imports\n\n// snippet-start: main\nfunc main() {\n\tdefiner := func(ctx context.Context, config cfg.Config, logger log.Logger) (*httpserver.Definitions, error) {\n\t\t// Instantiated a new Definitions object.\n\t\tdef := &httpserver.Definitions{}\n\n\t\tvar err error\n\t\tvar handler crud.Handler\n\n\t\t// Created a new CRUD handler.\n\t\tif handler, err = NewTodoCrudHandler(ctx, config, logger); err != nil {\n\t\t\treturn nil, fmt.Errorf("can not create trip handler: %w", err)\n\t\t}\n\n\t\t// Add CRUD handlers to your definitions. This is a convenience method for adding handlers for Create, Read, Update, Delete, and List.\n\t\tif err := crud.AddCrudHandlers(config, logger, def, 0, "todo", handler); err != nil {\n\t\t\treturn nil, fmt.Errorf("can not add crud handlers: %w", err)\n\t\t}\n\n\t\treturn def, nil\n\t}\n\n\t// Run your server with the definitions.\n\tapplication.RunHttpDefaultServer(definer)\n}\n\n// snippet-end: main\n',a={sidebar_position:4,title:"Write a CRUD SQL app"},c=void 0,h={},u=[{value:"Before you begin",id:"before-you-begin",level:2},{value:"Set up your file structure",id:"set-up-your-file-structure",level:2},{value:"Implement handler.go",id:"implement-handlergo",level:2},{value:"Import dependencies",id:"import-dependencies",level:3},{value:"Define your database settings",id:"define-your-database-settings",level:3},{value:"Define your Todo struct",id:"define-your-todo-struct",level:3},{value:"Define your input structs",id:"define-your-input-structs",level:3},{value:"Define your <code>TodoCrudHandler</code>",id:"define-your-todocrudhandler",level:3},{value:"Implement a constructor",id:"implement-a-constructor",level:3},{value:"Implement the methods for your handler",id:"implement-the-methods-for-your-handler",level:3},{value:"Implement main.go",id:"implement-maingo",level:2},{value:"Import dependencies",id:"import-dependencies-1",level:3},{value:"Implement main()",id:"implement-main",level:3},{value:"Configure your server",id:"configure-your-server",level:2},{value:"Add an initial migration",id:"add-an-initial-migration",level:2},{value:"Configure docker-compose",id:"configure-docker-compose",level:2},{value:"Test your work",id:"test-your-work",level:2},{value:"Start MySQL",id:"start-mysql",level:3},{value:"Run your server",id:"run-your-server",level:3},{value:"Make requests",id:"make-requests",level:3},{value:"Check the database",id:"check-the-database",level:2},{value:"Conclusion",id:"conclusion",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["A common REST API structure provides methods for users to ",(0,o.jsx)(n.strong,{children:"create"}),", ",(0,o.jsx)(n.strong,{children:"read"}),", ",(0,o.jsx)(n.strong,{children:"update"}),", and ",(0,o.jsx)(n.strong,{children:"delete"})," (CRUD) resources. In this tutorial, you'll:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Create an HTTP server that provides these CRUD methods"}),"\n",(0,o.jsx)(n.li,{children:"Implement logic that interfaces with a MySQL backend"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:'Specifically, users of your service will be able create, read, update, and delete todos, such as you might use for a "To do list".'}),"\n",(0,o.jsx)(n.h2,{id:"before-you-begin",children:"Before you begin"}),"\n",(0,o.jsx)(n.p,{children:"While this tutorial requires no prior code, it is an intermediate gosoline tutorial and, therefore, skips some explanations. To understand the logic in this tutorial, you should have already completed at least one of the following tutorials first:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/quickstart/http-server/create-an-http-server",children:"Create an HTTP server"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/quickstart/http-server/create-a-money-exchange-app",children:"Create a money exchange app"})}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"This tutorial also assumes you have some basic knowledge about relational databases, such as:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Data models"}),"\n",(0,o.jsx)(n.li,{children:"Primary keys"}),"\n",(0,o.jsx)(n.li,{children:"Migrations"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Before you begin, make sure you have the following installed on your machine:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://go.dev/doc/install",children:"Golang"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.docker.com/engine/install/",children:"Docker"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.docker.com/compose/install/",children:"Docker Compose"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"set-up-your-file-structure",children:"Set up your file structure"}),"\n",(0,o.jsx)(n.p,{children:"First, you need to set up the following file structure:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",children:"crud/\n\u251c\u2500\u2500 migrations\n\u2502   \u2514\u2500\u2500 1_initialize_schema.up.sql\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 handler.go\n\u251c\u2500\u2500 config.dist.yml\n\u2514\u2500\u2500 main.go\n"})}),"\n",(0,o.jsx)(n.p,{children:"For example, in Unix, run:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"mkdir crud; cd crud\nmkdir migrations\ntouch migrations/1_initialize_schema.up.sql\ntouch docker-compose.yml\ntouch handler.go\ntouch config.dist.yml\ntouch main.go\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Those are all the files you need to build your CRUD service with gosoline! Next, you'll implement each of these files, starting with ",(0,o.jsx)(n.code,{children:"handler.go"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"implement-handlergo",children:"Implement handler.go"}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.code,{children:"handler.go"}),", add the following code:"]}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"handler.go"}),(0,o.jsx)(i.N,{showLineNumbers:!0,language:"go",children:d})]}),"\n",(0,o.jsx)(n.p,{children:"Now, you'll walkthrough this file in detail to learn how it works."}),"\n",(0,o.jsx)(n.h3,{id:"import-dependencies",children:"Import dependencies"}),"\n",(0,o.jsxs)(n.p,{children:["At the top of ",(0,o.jsx)(n.code,{children:"handler.go"}),", you declared the package and imported some dependencies:"]}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"imports",children:d}),"\n",(0,o.jsxs)(n.p,{children:["Here, you declared the package as ",(0,o.jsx)(n.code,{children:"main"}),". Then, you imported the ",(0,o.jsx)(n.code,{children:"context"}),", ",(0,o.jsx)(n.code,{children:"fmt"}),", and ",(0,o.jsx)(n.code,{children:"time"})," modules along with several gosoline dependencies."]}),"\n",(0,o.jsx)(n.h3,{id:"define-your-database-settings",children:"Define your database settings"}),"\n",(0,o.jsx)(n.p,{children:"In this tutorial, you use a MySQL database to manage todo records. So, you first defined the settings for the data:"}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"settings",children:d}),"\n",(0,o.jsx)(n.p,{children:"These settings include a model name, table name, and primary key."}),"\n",(0,o.jsx)(n.h3,{id:"define-your-todo-struct",children:"Define your Todo struct"}),"\n",(0,o.jsx)(n.p,{children:"Next, you defined a structure to model your todos:"}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"todo",children:d}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"Todo"})," has three values:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["A ",(0,o.jsx)(n.a,{href:"https://github.com/justtrackio/gosoline/blob/9b64c30bc4156d16fb1f2d11930f0b686b5d0113/pkg/db-repo/model.go#L17",children:"database model"})]}),"\n",(0,o.jsx)(n.li,{children:"Some text"}),"\n",(0,o.jsx)(n.li,{children:"A due date for the todo"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"define-your-input-structs",children:"Define your input structs"}),"\n",(0,o.jsx)(n.p,{children:"Next, you defined two structures for handling request input:"}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"create and update",children:d}),"\n",(0,o.jsx)(n.p,{children:"When you create a todo, you'll pass the todo's text and a due date. When you update a todo, you'll pass only the text. Here, you defined the structures for parsing and storing that information."}),"\n",(0,o.jsxs)(n.h3,{id:"define-your-todocrudhandler",children:["Define your ",(0,o.jsx)(n.code,{children:"TodoCrudHandler"})]}),"\n",(0,o.jsx)(n.p,{children:"Next, you defined a handler for CRUD requests:"}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"crud handler",children:d}),"\n",(0,o.jsxs)(n.p,{children:["Here, the handler has a ",(0,o.jsx)(n.code,{children:"repo"}),", which implements the ",(0,o.jsx)(n.a,{href:"https://github.com/justtrackio/gosoline/blob/3c9f7b66578c95dca509faa35f653ef16ca12340/pkg/db-repo/repository.go#L55",children:(0,o.jsx)(n.code,{children:"Repository"})})," interface. This ",(0,o.jsx)(n.code,{children:"repo"})," implements model-based methods for creating, reading, updating, and deleting resources."]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.a,{href:"https://github.com/justtrackio/gosoline/blob/3c9f7b66578c95dca509faa35f653ef16ca12340/pkg/db-repo/repository.go#L44C4-L44C4",children:'"read" method'})," is a special case for ",(0,o.jsx)(n.code,{children:"repo"})," because it implements multiple handlers for reading information:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Read()"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Query()"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"Count()"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"GetModelId()"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"GetModelName()"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"GetMetadata()"})}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["The V0 in ",(0,o.jsx)(n.code,{children:"TodoCrudHandlerV0"})," sets up a structure for you to version this handler later."]})}),"\n",(0,o.jsx)(n.p,{children:"Later, you implement the methods for this struct."}),"\n",(0,o.jsx)(n.h3,{id:"implement-a-constructor",children:"Implement a constructor"}),"\n",(0,o.jsxs)(n.p,{children:["Next, you implemented a constructor for your ",(0,o.jsx)(n.code,{children:"TodoCrudHandlerV0"}),":"]}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"todo constructor",children:d}),"\n",(0,o.jsx)(n.h3,{id:"implement-the-methods-for-your-handler",children:"Implement the methods for your handler"}),"\n",(0,o.jsxs)(n.p,{children:["Finally, you implemented the following methods for your ",(0,o.jsx)(n.code,{children:"TodoCrudHandlerV0"}),":"]}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"get repo",children:d}),"\n",(0,o.jsx)(n.p,{children:"This returns the handler's repository object."}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"get model",children:d}),"\n",(0,o.jsxs)(n.p,{children:["This returns the ",(0,o.jsx)(n.code,{children:"Todo"})," model."]}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"create input",children:d}),"\n",(0,o.jsxs)(n.p,{children:["This returns the ",(0,o.jsx)(n.code,{children:"CreateInput"})," struct."]}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"transform create",children:d}),"\n",(0,o.jsxs)(n.p,{children:["This parses the ",(0,o.jsx)(n.code,{children:"Text"})," and ",(0,o.jsx)(n.code,{children:"DueDate"})," from a ",(0,o.jsx)(n.code,{children:"CreateInput"})," object and sets them on a ",(0,o.jsx)(n.code,{children:"Todo"})," model. This is used for Create requests."]}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"get update input",children:d}),"\n",(0,o.jsxs)(n.p,{children:["This returns the ",(0,o.jsx)(n.code,{children:"UpdateInput"})," struct."]}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"transform update",children:d}),"\n",(0,o.jsxs)(n.p,{children:["This parses the ",(0,o.jsx)(n.code,{children:"Text"})," from an ",(0,o.jsx)(n.code,{children:"UpdateInput"})," object and sets them on a ",(0,o.jsx)(n.code,{children:"Todo"})," model. This is used for Update requests."]}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"transform output",children:d}),"\n",(0,o.jsx)(n.p,{children:"This simply returns the model with no transformations."}),"\n",(0,o.jsx)(i.N,{title:"handler.go",language:"go",snippet:"list",children:d}),"\n",(0,o.jsx)(n.p,{children:"Now, you've implemented the handlers and logic for a model-based CRUD API. Next, you'll implement a main function that applies this logic."}),"\n",(0,o.jsx)(n.h2,{id:"implement-maingo",children:"Implement main.go"}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.code,{children:"main.go"}),", add the following code:"]}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"main.go"}),(0,o.jsx)("p",{children:(0,o.jsx)(i.N,{showLineNumbers:!0,language:"go",children:l})})]}),"\n",(0,o.jsx)(n.p,{children:"Now, you'll walkthrough this file in detail to learn how it works."}),"\n",(0,o.jsx)(n.h3,{id:"import-dependencies-1",children:"Import dependencies"}),"\n",(0,o.jsxs)(n.p,{children:["At the top of ",(0,o.jsx)(n.code,{children:"main.go"}),", you declared the package and imported some dependencies:"]}),"\n",(0,o.jsx)(i.N,{title:"main.go",language:"go",snippet:"imports",children:l}),"\n",(0,o.jsxs)(n.p,{children:["Here, you declared the package as ",(0,o.jsx)(n.code,{children:"main"}),". Then, you imported the ",(0,o.jsx)(n.code,{children:"context"})," and ",(0,o.jsx)(n.code,{children:"fmt"})," modules along with several gosoline dependencies."]}),"\n",(0,o.jsx)(n.h3,{id:"implement-main",children:"Implement main()"}),"\n",(0,o.jsxs)(n.p,{children:["Then, you implemented ",(0,o.jsx)(n.code,{children:"main()"}),":"]}),"\n",(0,o.jsx)(i.N,{title:"main.go",language:"go",snippet:"main",children:l}),"\n",(0,o.jsx)(n.p,{children:"Now that you have all your logic, you'll move on to setting up your server and docker container."}),"\n",(0,o.jsx)(n.h2,{id:"configure-your-server",children:"Configure your server"}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.code,{children:"config.dist.yml"}),", configure your server:"]}),"\n",(0,o.jsx)(i.N,{showLineNumbers:!0,language:"yaml",title:"config.dist.yml",children:"env: dev\napp_project: gosoline\napp_family: how-to\napp_group: crud\napp_name: server\n\ndb:\n  default:\n    driver: mysql\n    parse_time: true\n    uri:\n      host: 127.0.0.1\n      port: 3306\n      user: gosoline\n      password: gosoline\n      database: gosoline\n    migrations:\n      enabled: true\n      table_prefixed: false\n      path: migrations\n"}),"\n",(0,o.jsx)(n.p,{children:"Here, you set some minimal configurations for your web server. You also configured your MySQL database, including the migrations you'll run to build a table for your todos. This migration will live in the migrations directory. You'll add this next."}),"\n",(0,o.jsx)(n.h2,{id:"add-an-initial-migration",children:"Add an initial migration"}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.code,{children:"migrations/1_initialize_schema.up.sql"}),", add a migration that creates a ",(0,o.jsx)(n.code,{children:"todos"})," table:"]}),"\n",(0,o.jsx)(i.N,{showLineNumbers:!0,language:"sql",title:"migrations/1_initialize_schema.up.sql",children:"-- +goose Up\n-- +goose StatementBegin\ncreate table todos\n(\n    id         int       auto_increment primary key,\n    text       text      not null,\n    due_date   timestamp not null,\n    updated_at timestamp not null,\n    created_at timestamp not null\n);\n-- +goose StatementEnd"}),"\n",(0,o.jsxs)(n.p,{children:["Here, you created a table, called ",(0,o.jsx)(n.code,{children:"todos"}),", with five columns:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"id"}),": The todo's identifier."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"text"}),": The todo's text."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"due_date"}),": The todo's due date."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"updated_at"}),": The last time the todo was updated."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"created_at"}),": The time the todo was created."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"configure-docker-compose",children:"Configure docker-compose"}),"\n",(0,o.jsx)(n.p,{children:"Next, in docker-compose.yml, add the following configurations:"}),"\n",(0,o.jsx)(i.N,{showLineNumbers:!0,language:"yaml",title:"docker-compose.yml",children:'version: "3.6"\n\nservices:\n  mysql:\n    image: mysql:8.0.31\n    command: --sql_mode="NO_ENGINE_SUBSTITUTION" --log-bin-trust-function-creators=TRUE\n    ports:\n      - 3306:3306\n    environment:\n      - MYSQL_DATABASE=gosoline\n      - MYSQL_USER=gosoline\n      - MYSQL_PASSWORD=gosoline\n      - MYSQL_ROOT_PASSWORD=gosoline'}),"\n",(0,o.jsx)(n.p,{children:"This sets up docker-compose to create a container running a MySQL server."}),"\n",(0,o.jsx)(n.h2,{id:"test-your-work",children:"Test your work"}),"\n",(0,o.jsx)(n.p,{children:"Now it's time to test your work and make sure everything you created works properly."}),"\n",(0,o.jsx)(n.h3,{id:"start-mysql",children:"Start MySQL"}),"\n",(0,o.jsx)(n.p,{children:"First, start your MySQL container:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"docker-compose up\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Now, you have a MySQL database running in a container. You can see it running on port 3306 with ",(0,o.jsx)(n.code,{children:"docker ps"})," in another shell:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                               NAMES\nccf507fd70e4   mysql:8.0.31   "docker-entrypoint.s\u2026"   10 minutes ago   Up 10 minutes   0.0.0.0:3306->3306/tcp, 33060/tcp   write-crud-sql-app-mysql-1\n'})}),"\n",(0,o.jsx)(n.h3,{id:"run-your-server",children:"Run your server"}),"\n",(0,o.jsxs)(n.p,{children:["In another shell, navigate to the root ",(0,o.jsx)(n.code,{children:"crud"})," directory of this project and spin up your server:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"go mod init crud/m\ngo mod tidy\ngo run .\n"})}),"\n",(0,o.jsx)(n.p,{children:"You'll see logs of your server running."}),"\n",(0,o.jsx)(n.h3,{id:"make-requests",children:"Make requests"}),"\n",(0,o.jsx)(n.p,{children:"Finally, in a third shell, make requests to your service. For example, create a todo:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'curl -d \'{"text":"do it!", "dueDate":"2023-09-08T15:00:00Z"}\' -H "Content-Type: application/json" -X POST localhost:8080/v0/todo\n'})}),"\n",(0,o.jsx)(n.p,{children:"View the todo:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl -X GET localhost:8080/v0/todo/1\n"})}),"\n",(0,o.jsx)(n.p,{children:"Update the todo:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'curl -d \'{"text":"do it!!!"}\' -H "Content-Type: application/json" -X PUT localhost:8080/v0/todo/1\n'})}),"\n",(0,o.jsx)(n.p,{children:"View the todo again to observe the changes:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl -X GET localhost:8080/v0/todo/1\n"})}),"\n",(0,o.jsx)(n.p,{children:"List all todos:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl -d '{}' -X POST localhost:8080/v0/todos\n"})}),"\n",(0,o.jsx)(n.p,{children:"Delete a todo:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl -X DELETE localhost:8080/v0/todo/1\n"})}),"\n",(0,o.jsx)(n.h2,{id:"check-the-database",children:"Check the database"}),"\n",(0,o.jsx)(n.p,{children:"To verify that everything is working as you expected on the backend, check the database."}),"\n",(0,o.jsx)(n.p,{children:"First, look up your database container id:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'$ docker ps\nCONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                               NAMES\nccf507fd70e4   mysql:8.0.31   "docker-entrypoint.s\u2026"   19 minutes ago   Up 19 minutes   0.0.0.0:3306->3306/tcp, 33060/tcp   write-crud-sql-app-mysql-1\n'})}),"\n",(0,o.jsxs)(n.p,{children:["In this example, the container id is ",(0,o.jsx)(n.code,{children:"ccf507fd70e4"}),", but it'll be different for you."]}),"\n",(0,o.jsxs)(n.p,{children:["Next, log into ",(0,o.jsx)(n.code,{children:"mysql"})," in the container:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"docker exec -it ccf507fd70e4 mysql -u root -p\n"})}),"\n",(0,o.jsx)(n.p,{children:"There are two things to note:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Use your MySQL container id here instead of ",(0,o.jsx)(n.code,{children:"ccf507fd70e4"})]}),"\n",(0,o.jsxs)(n.li,{children:["Use the password ",(0,o.jsx)(n.code,{children:"gosoline"}),", as you previously defined in ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["From the ",(0,o.jsx)(n.code,{children:"mysql"})," console, change to the ",(0,o.jsx)(n.code,{children:"gosoline"})," database:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"mysql> use gosoline\nDatabase changed\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Finally, query the ",(0,o.jsx)(n.code,{children:"todos"})," table to see your records:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"mysql> select * from todos;\n+----+----------+---------------------+---------------------+---------------------+\n| id | text     | due_date            | updated_at          | created_at          |\n+----+----------+---------------------+---------------------+---------------------+\n|  1 | do it!!! | 2023-09-08 15:00:00 | 2023-09-12 09:35:22 | 2023-09-12 09:35:12 |\n+----+----------+---------------------+---------------------+---------------------+\n"})}),"\n",(0,o.jsx)(n.p,{children:"If you have no records, you'll need to create one:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'curl -d \'{"text":"do it!", "dueDate":"2023-09-08T15:00:00Z"}\' -H "Content-Type: application/json" -X POST localhost:8080/v0/todo\n'})}),"\n",(0,o.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsx)(n.p,{children:"And you're done! You've used gosoline to create a fully-fledged CRUD API service, complete with endpoints for:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Create"}),"\n",(0,o.jsx)(n.li,{children:"Read"}),"\n",(0,o.jsx)(n.li,{children:"Update"}),"\n",(0,o.jsx)(n.li,{children:"Delete"}),"\n",(0,o.jsx)(n.li,{children:"List"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"You also used docker to host a MySQL database and used a Todo model to handle API inputs and outputs as well as to store data in the table."})]})}function m(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(p,{...e})}):p(e)}}}]);