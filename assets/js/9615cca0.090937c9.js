"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1541],{2754(e,n,t){t.d(n,{N:()=>y,v:()=>f});t(6540);var r=t(3796),o=t(5430),i=t(4501),s=t(5292),l=t(5433),d=t(6311),a=t(7625),c=t(1662),h=t(6645),p=t(3457),u=t(467),g=t(3865),x=t(5293),j=t(6025),m=t(4848);function f(){const{colorMode:e}=(0,x.G)(),n="dark"===e,t=(0,u.A)({palette:{mode:n?"dark":"light"}});return(0,m.jsx)(g.A,{theme:t,children:(0,m.jsxs)(c.Ay,{container:!0,spacing:4,children:[(0,m.jsx)(c.Ay,{item:!0,xs:12,s:12,md:4,children:(0,m.jsxs)(r.A,{style:{height:"100%"},children:[(0,m.jsx)(i.A,{title:"HTTP Server",avatar:(0,m.jsx)(h.A,{}),titleTypographyProps:{variant:"h6"}}),(0,m.jsx)(s.A,{children:"Build REST web services with HTTP handling, caching, OAuth, and much more."}),(0,m.jsx)(o.A,{children:(0,m.jsx)(l.A,{size:"small",href:(0,j.Ay)("/category/http-server"),children:"Get started"})})]})}),(0,m.jsx)(c.Ay,{item:!0,xs:12,md:4,children:(0,m.jsxs)(r.A,{style:{height:"100%"},children:[(0,m.jsx)(i.A,{title:"Message Queues",avatar:(0,m.jsx)(d.A,{}),titleTypographyProps:{variant:"h6"}}),(0,m.jsx)(s.A,{children:"Process asynchronous messages from Kafka, Redis, or any other queuing or streaming system."}),(0,m.jsx)(o.A,{children:(0,m.jsx)(l.A,{size:"small",href:(0,j.Ay)("/quickstart/create-a-consumer"),children:"Get started"})})]})}),(0,m.jsx)(c.Ay,{item:!0,xs:12,md:4,children:(0,m.jsxs)(r.A,{style:{height:"100%"},children:[(0,m.jsx)(i.A,{title:"Kernel Module",avatar:(0,m.jsx)(a.A,{}),titleTypographyProps:{variant:"h6"}}),(0,m.jsx)(s.A,{children:"Implement a kernel module with which you can do anything, using gosoline's logging, configuration, and other solutions."}),(0,m.jsx)(o.A,{children:(0,m.jsx)(l.A,{size:"small",href:(0,j.Ay)("/quickstart/create-an-application"),children:"Get started"})})]})})]})})}function y({children:e,snippet:n,...t}){let r=e.replace(/\n$/,"");var o=!1;if(n){const e=new RegExp(`(?://|#) snippet-start: ${n}s*(.*)(?://|#) snippet-end: ${n}s*$`,"sm");let t=r.match(e);t&&(r=t[1],o=!0)}return r=r.split("\n").filter(function(e){return!new RegExp("w*?(?://|#) snippet.*\n*?$","g").test(e)}),o&&(r=r.slice(1,-1)),r=r.join("\n"),(0,m.jsx)(p.A,{...t,children:r})}},4734(e,n,t){t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>c,default:()=>g,frontMatter:()=>a,metadata:()=>r,toc:()=>p});const r=JSON.parse('{"id":"quickstart/http-server/create-an-http-server","title":"Create an HTTP server","description":"One of the primary use cases for gosoline is to create a REST web service. In this tutorial, you\'ll do just that!","source":"@site/docs/quickstart/http-server/create-an-http-server.mdx","sourceDirName":"quickstart/http-server","slug":"/quickstart/http-server/create-an-http-server","permalink":"/gosoline/quickstart/http-server/create-an-http-server","draft":false,"unlisted":false,"editUrl":"https://github.com/justtrackio/gosoline/tree/main/docs/docs/quickstart/http-server/create-an-http-server.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Create an HTTP server"},"sidebar":"docSidebar","previous":{"title":"HTTP Server","permalink":"/gosoline/category/http-server"},"next":{"title":"Create a money exchange app","permalink":"/gosoline/quickstart/http-server/create-a-money-exchange-app"}}');var o=t(4848),i=t(8453),s=t(2754);const l='// snippet-start: imports\npackage main\n\nimport (\n\t"context"\n\t"fmt"\n\t"time"\n\n\t"github.com/justtrackio/gosoline/pkg/cfg"\n\t"github.com/justtrackio/gosoline/pkg/httpserver"\n\t"github.com/justtrackio/gosoline/pkg/log"\n)\n\n// snippet-end: imports\n\n// snippet-start: todo struct\ntype Todo struct {\n\tId        int    `form:"id"`\n\tText      string `form:"text"`\n\tCreatedAt time.Time\n}\n\n// snippet-end: todo struct\n\n// snippet-start: todo handler\ntype TodoHandler struct {\n\tlogger log.Logger\n}\n\n// snippet-end: todo handler\n\n// snippet-start: get input\nfunc (t TodoHandler) GetInput() any {\n\treturn &Todo{}\n}\n\n// snippet-end: get input\n\n// snippet-start: new todo handler\nfunc NewTodoHandler(ctx context.Context, config cfg.Config, logger log.Logger) (*TodoHandler, error) {\n\thandler := &TodoHandler{\n\t\tlogger: logger,\n\t}\n\n\treturn handler, nil\n}\n\n// snippet-end: new todo handler\n\n// snippet-start: handle\nfunc (t TodoHandler) Handle(ctx context.Context, request *httpserver.Request) (*httpserver.Response, error) {\n\t// Initialize a Todo struct from the request body\n\ttodo := request.Body.(*Todo)\n\n\t// Set its CreatedAt to now\n\ttodo.CreatedAt = time.Now()\n\n\t// The error gets transformed within the http server to an HTTP 500 response\n\tif todo.Id <= 0 {\n\t\treturn nil, fmt.Errorf("invalid id")\n\t}\n\n\t// Log the request using the TodoHandler struct\'s logger\n\tt.logger.Info(ctx, "got todo with id %d", todo.Id)\n\n\t// Return a Json response object with information from the Todo struct\n\treturn httpserver.NewJsonResponse(todo), nil\n}\n\n// snippet-end: handle\n',d='// snippet-start: imports\npackage main\n\nimport (\n\t"context"\n\t"fmt"\n\n\t"github.com/justtrackio/gosoline/pkg/application"\n\t"github.com/justtrackio/gosoline/pkg/cfg"\n\t"github.com/justtrackio/gosoline/pkg/httpserver"\n\t"github.com/justtrackio/gosoline/pkg/log"\n)\n\n// snippet-end: imports\n\n// snippet-start: main\nfunc main() {\n\t// Initialize an HTTP server factory that defines your HTTP route\n\tdefiner := func(ctx context.Context, config cfg.Config, logger log.Logger) (*httpserver.Definitions, error) {\n\t\t// Initialize a reference to httpserver.Definitions, which you use to create a GET route\n\t\tdef := &httpserver.Definitions{}\n\n\t\t// Instantiate two new variables for handling errors and request input data\n\t\tvar err error\n\t\tvar handler httpserver.HandlerWithInput\n\n\t\t// Create a handler (`NewTodoHandler`) that handles the request input data.\n\t\t// If there is an error, return an error message.\n\t\t// If there is no error, assign this `NewTodoHandler` to the `handler` variable from the last step.\n\t\tif handler, err = NewTodoHandler(ctx, config, logger); err != nil {\n\t\t\treturn nil, fmt.Errorf("can not create trip handler: %w", err)\n\t\t}\n\n\t\t// Create a GET route for the endpoint /todo, using the handler\n\t\tdef.GET("/todo", httpserver.CreateQueryHandler(handler))\n\n\t\t// Return the response from handler\n\t\treturn def, nil\n\t}\n\n\t// Run an HTTP server application based on the logic from the previous steps\n\tapplication.RunHttpDefaultServer(definer)\n}\n\n// snippet-end: main\n',a={sidebar_position:1,title:"Create an HTTP server"},c=void 0,h={},p=[{value:"Before you begin",id:"before-you-begin",level:2},{value:"Set up your file structure",id:"set-up-your-file-structure",level:2},{value:"Implement handler.go",id:"implement-handlergo",level:2},{value:"Import dependencies",id:"import-dependencies",level:3},{value:"Define a Todo",id:"define-a-todo",level:3},{value:"Create a TodoHandler",id:"create-a-todohandler",level:3},{value:"Get request inputs",id:"get-request-inputs",level:3},{value:"Handle new todos",id:"handle-new-todos",level:3},{value:"Handle requests",id:"handle-requests",level:3},{value:"Implement main.go",id:"implement-maingo",level:2},{value:"Import dependencies",id:"import-dependencies-1",level:3},{value:"Create your main entry point",id:"create-your-main-entry-point",level:3},{value:"Configure your server",id:"configure-your-server",level:2},{value:"Test your gosoline server",id:"test-your-gosoline-server",level:2},{value:"Conclusion",id:"conclusion",level:2}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"One of the primary use cases for gosoline is to create a REST web service. In this tutorial, you'll do just that!"}),"\n",(0,o.jsx)(n.p,{children:"Specifically, you'll use gosoline to create a web service that handles a single endpoint:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-http",children:"GET /todo?id={ID}&text={TODO TEXT}\n"})}),"\n",(0,o.jsx)(n.p,{children:"This endpoint will:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Accept the data from the request's querystring"}),"\n",(0,o.jsxs)(n.li,{children:["Send a Json response with the ",(0,o.jsx)(n.code,{children:"id"})," and ",(0,o.jsx)(n.code,{children:"text"})," from the request, along with an ISO-formatted creation date and time."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Here's an example response:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "Id": 3,\n  "Text": "doit",\n  "CreatedAt": "2023-09-05T11:18:09.325852335+02:00"\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"before-you-begin",children:"Before you begin"}),"\n",(0,o.jsxs)(n.p,{children:["Before you begin, make sure you have ",(0,o.jsx)(n.a,{href:"https://go.dev/doc/install",children:"Golang"})," installed on your machine."]}),"\n",(0,o.jsx)(n.h2,{id:"set-up-your-file-structure",children:"Set up your file structure"}),"\n",(0,o.jsx)(n.p,{children:"First, you need to set up the following file structure:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",children:"todo/\n\u251c\u2500\u2500 handler.go\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 config.dist.yml\n"})}),"\n",(0,o.jsx)(n.p,{children:"For example, in Unix, run:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"mkdir todo; cd todo\ntouch handler.go\ntouch main.go\ntouch config.dist.yml\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Those are all the files you need to build your web service with gosoline! Next, you'll implement each of these files, starting with ",(0,o.jsx)(n.code,{children:"handler.go"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"implement-handlergo",children:"Implement handler.go"}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.code,{children:"handler.go"}),", add the following code:"]}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"handler.go"}),(0,o.jsx)("p",{children:(0,o.jsx)(s.N,{showLineNumbers:!0,language:"go",children:l})})]}),"\n",(0,o.jsx)(n.p,{children:"Now, you'll walkthrough this file in detail to learn how it works."}),"\n",(0,o.jsx)(n.h3,{id:"import-dependencies",children:"Import dependencies"}),"\n",(0,o.jsxs)(n.p,{children:["At the top of ",(0,o.jsx)(n.code,{children:"handler.go"}),", you declared the package and imported some dependencies:"]}),"\n",(0,o.jsx)(s.N,{language:"go",title:"handler.go",snippet:"imports",children:l}),"\n",(0,o.jsxs)(n.p,{children:["Here, you declared the package as ",(0,o.jsx)(n.code,{children:"main"}),". Then, you imported the ",(0,o.jsx)(n.code,{children:"context"})," and ",(0,o.jsx)(n.code,{children:"time"})," modules along with three gosoline dependencies:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/reference/package-cfg",children:(0,o.jsx)(n.code,{children:"cfg"})})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/reference/package-httpserver",children:(0,o.jsx)(n.code,{children:"httpserver"})})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/reference/package-log",children:(0,o.jsx)(n.code,{children:"log"})})}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"define-a-todo",children:"Define a Todo"}),"\n",(0,o.jsxs)(n.p,{children:["Next, you created a ",(0,o.jsx)(n.code,{children:"Todo"})," struct:"]}),"\n",(0,o.jsx)(s.N,{language:"go",title:"handler.go",snippet:"todo struct",children:l}),"\n",(0,o.jsx)(n.p,{children:"Later in this file, you'll use this to bind the data from the HTTP querystring. Referring back to the specification for your todo service, the expected querystring looks like this:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-http",children:"?id={ID}&text={TODO TEXT}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["So, in your struct, you have an ",(0,o.jsx)(n.code,{children:"Id"})," and a ",(0,o.jsx)(n.code,{children:"Text"}),". With the ",(0,o.jsx)(n.code,{children:"form:"})," tag, you've specified the querystring parameter from which to pull the value for these keys."]}),"\n",(0,o.jsx)(n.h3,{id:"create-a-todohandler",children:"Create a TodoHandler"}),"\n",(0,o.jsx)(n.p,{children:"Next, you created a struct for handling todos:"}),"\n",(0,o.jsx)(s.N,{language:"go",title:"handler.go",snippet:"todo handler",children:l}),"\n",(0,o.jsxs)(n.p,{children:["This is a simple structure that holds a ",(0,o.jsx)(n.code,{children:"log.Logger"})," reference."]}),"\n",(0,o.jsx)(n.h3,{id:"get-request-inputs",children:"Get request inputs"}),"\n",(0,o.jsxs)(n.p,{children:["Next, you created a function called ",(0,o.jsx)(n.code,{children:"GetInput()"})," that returns the input instance to use:"]}),"\n",(0,o.jsx)(s.N,{language:"go",title:"handler.go",snippet:"get input",children:l}),"\n",(0,o.jsxs)(n.p,{children:["This is required because your ",(0,o.jsx)(n.code,{children:"TodoHandler"})," must implement the ",(0,o.jsx)(n.code,{children:"GetInput()"})," method of the ",(0,o.jsx)(n.code,{children:"httpserver.HandlerWithInput"})," interface."]}),"\n",(0,o.jsx)(n.h3,{id:"handle-new-todos",children:"Handle new todos"}),"\n",(0,o.jsxs)(n.p,{children:["Next, you created a function called ",(0,o.jsx)(n.code,{children:"NewTodoHandler()"}),":"]}),"\n",(0,o.jsx)(s.N,{language:"go",title:"handler.go",snippet:"new todo handler",children:l}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"config"})," and ",(0,o.jsx)(n.code,{children:"logger"})," argument types come from gosoline. This function initializes a new ",(0,o.jsx)(n.code,{children:"TodoHandler"})," and assigns it the ",(0,o.jsx)(n.code,{children:"logger"}),". Then, it returns the handler with no error."]}),"\n",(0,o.jsx)(n.h3,{id:"handle-requests",children:"Handle requests"}),"\n",(0,o.jsxs)(n.p,{children:["Finally, you created a ",(0,o.jsx)(n.code,{children:"Handle()"})," function that accepts a ",(0,o.jsx)(n.code,{children:"context.Context"})," and an ",(0,o.jsx)(n.code,{children:"httpserver.Request"})," (also from gosoline) and handles that request:"]}),"\n",(0,o.jsx)(s.N,{language:"go",title:"handler.go",snippet:"handle",children:l}),"\n",(0,o.jsxs)(n.p,{children:["Here, you handle requests and responses in just a few lines of code. ",(0,o.jsx)(n.code,{children:"handler.go"})," does most of the heavy lifting for your web service.\nNotice, that you can return an error to the httpserver package - there is built in error handling to respond with appropriate status and responses."]}),"\n",(0,o.jsxs)(n.p,{children:["However, you still need a main entry point to your service, where you'll make use of the logic in ",(0,o.jsx)(n.code,{children:"handler.go"}),". This, you'll add in ",(0,o.jsx)(n.code,{children:"main.go"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"implement-maingo",children:"Implement main.go"}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.code,{children:"main.go"}),", add the following code:"]}),"\n",(0,o.jsxs)(t,{children:[(0,o.jsx)("summary",{children:"main.go"}),(0,o.jsx)("p",{children:(0,o.jsx)(s.N,{showLineNumbers:!0,language:"go",children:d})})]}),"\n",(0,o.jsx)(n.p,{children:"Now, you'll walkthrough this file in detail to learn how it works."}),"\n",(0,o.jsx)(n.h3,{id:"import-dependencies-1",children:"Import dependencies"}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.code,{children:"main.go"}),", you declared the package and imported some dependencies:"]}),"\n",(0,o.jsx)(s.N,{language:"go",title:"main.go",snippet:"imports",children:d}),"\n",(0,o.jsxs)(n.p,{children:["Here, you declared the package as ",(0,o.jsx)(n.code,{children:"main"}),". Then, you imported the ",(0,o.jsx)(n.code,{children:"context"})," and ",(0,o.jsx)(n.code,{children:"time"})," modules along with four gosoline dependencies:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"application"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/reference/package-cfg",children:(0,o.jsx)(n.code,{children:"cfg"})})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/reference/package-httpserver",children:(0,o.jsx)(n.code,{children:"httpserver"})})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/reference/package-log",children:(0,o.jsx)(n.code,{children:"log"})})}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"create-your-main-entry-point",children:"Create your main entry point"}),"\n",(0,o.jsxs)(n.p,{children:["Next, you created your ",(0,o.jsx)(n.code,{children:"main()"})," function as the entry point to your service:"]}),"\n",(0,o.jsx)(s.N,{language:"go",title:"main.go",snippet:"main",children:d}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"main()"})," puts together all the data structures and logic from ",(0,o.jsx)(n.code,{children:"handler.go"})," into a single, coherent function."]}),"\n",(0,o.jsx)(n.p,{children:"Now, you've implemented your server's main entry point and handler logic. Next, you'll configure your server."}),"\n",(0,o.jsx)(n.h2,{id:"configure-your-server",children:"Configure your server"}),"\n",(0,o.jsxs)(n.p,{children:["In ",(0,o.jsx)(n.code,{children:"config.dist.yml"}),", configure your server:"]}),"\n",(0,o.jsx)(s.N,{showLineNumbers:!0,language:"yaml",title:"config.dist.yml",children:"env: dev\napp_project: gosoline\napp_family: get-started\napp_group: http-server\napp_name: example\n"}),"\n",(0,o.jsx)(n.p,{children:"Here, you set some minimal configurations for your web server. The final step is to test it to confirm that it works as expected."}),"\n",(0,o.jsx)(n.h2,{id:"test-your-gosoline-server",children:"Test your gosoline server"}),"\n",(0,o.jsxs)(n.p,{children:["From the ",(0,o.jsx)(n.code,{children:"todo"})," directory, start your go module, install the dependencies, and run your server:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"go mod init todo/m\ngo mod tidy\ngo run .\n"})}),"\n",(0,o.jsx)(n.p,{children:"In your console, you'll see a log stream that indicates your server is running properly. By default, the server is exposed to localhost:8080."}),"\n",(0,o.jsxs)(n.p,{children:["Make a GET request to ",(0,o.jsx)(n.code,{children:"localhost:8080/todo"}),". For example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl 'localhost:8080/todo?id=1&text=do_it'\n"})}),"\n",(0,o.jsx)(n.p,{children:"You'll get the following output:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'{"Id":1,"Text":"do_it","CreatedAt":"2023-09-05T16:55:49.02692+02:00"}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsx)(n.p,{children:"That's it! You created your first gosoline web service. In this tutorial, you were able to:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Handle requests"}),"\n",(0,o.jsx)(n.li,{children:"Send Json-serialized responses"}),"\n",(0,o.jsx)(n.li,{children:"Log information"}),"\n",(0,o.jsx)(n.li,{children:"And more..."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Check out these resources to learn more about creating web services with gosoline:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/quickstart/http-server/create-a-money-exchange-app",children:"Create a money exchange app"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/reference/package-httpserver",children:"API reference for the httpserver package"})}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}}}]);