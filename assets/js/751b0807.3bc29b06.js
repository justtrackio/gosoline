"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2541],{2754(e,t,n){n.d(t,{N:()=>v,v:()=>j});n(6540);var s=n(3796),i=n(5430),r=n(4501),o=n(5292),a=n(5433),c=n(6311),l=n(7625),d=n(1662),u=n(6645),h=n(3457),p=n(467),m=n(3865),x=n(5293),g=n(6025),f=n(4848);function j(){const{colorMode:e}=(0,x.G)(),t="dark"===e,n=(0,p.A)({palette:{mode:t?"dark":"light"}});return(0,f.jsx)(m.A,{theme:n,children:(0,f.jsxs)(d.Ay,{container:!0,spacing:4,children:[(0,f.jsx)(d.Ay,{item:!0,xs:12,s:12,md:4,children:(0,f.jsxs)(s.A,{style:{height:"100%"},children:[(0,f.jsx)(r.A,{title:"HTTP Server",avatar:(0,f.jsx)(u.A,{}),titleTypographyProps:{variant:"h6"}}),(0,f.jsx)(o.A,{children:"Build REST web services with HTTP handling, caching, OAuth, and much more."}),(0,f.jsx)(i.A,{children:(0,f.jsx)(a.A,{size:"small",href:(0,g.Ay)("/category/http-server"),children:"Get started"})})]})}),(0,f.jsx)(d.Ay,{item:!0,xs:12,md:4,children:(0,f.jsxs)(s.A,{style:{height:"100%"},children:[(0,f.jsx)(r.A,{title:"Message Queues",avatar:(0,f.jsx)(c.A,{}),titleTypographyProps:{variant:"h6"}}),(0,f.jsx)(o.A,{children:"Process asynchronous messages from Kafka, Redis, or any other queuing or streaming system."}),(0,f.jsx)(i.A,{children:(0,f.jsx)(a.A,{size:"small",href:(0,g.Ay)("/quickstart/create-a-consumer"),children:"Get started"})})]})}),(0,f.jsx)(d.Ay,{item:!0,xs:12,md:4,children:(0,f.jsxs)(s.A,{style:{height:"100%"},children:[(0,f.jsx)(r.A,{title:"Kernel Module",avatar:(0,f.jsx)(l.A,{}),titleTypographyProps:{variant:"h6"}}),(0,f.jsx)(o.A,{children:"Implement a kernel module with which you can do anything, using gosoline's logging, configuration, and other solutions."}),(0,f.jsx)(i.A,{children:(0,f.jsx)(a.A,{size:"small",href:(0,g.Ay)("/quickstart/create-an-application"),children:"Get started"})})]})})]})})}function v({children:e,snippet:t,...n}){let s=e.replace(/\n$/,"");var i=!1;if(t){const e=new RegExp(`(?://|#) snippet-start: ${t}s*(.*)(?://|#) snippet-end: ${t}s*$`,"sm");let n=s.match(e);n&&(s=n[1],i=!0)}return s=s.split("\n").filter(function(e){return!new RegExp("w*?(?://|#) snippet.*\n*?$","g").test(e)}),i&&(s=s.slice(1,-1)),s=s.join("\n"),(0,f.jsx)(h.A,{...n,children:s})}},3308(e,t,n){n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"how-to/write-integration-tests","title":"Write integration tests","description":"In this section we will be looking at several types of integration tests provided by Gosoline. All of them can be used together in the same test, and Gosoline\'s suite package is responsible for reading their configuration, starting and running an application, then running the actual tests cases. Below is their description:","source":"@site/docs/how-to/write-integration-tests.mdx","sourceDirName":"how-to","slug":"/how-to/write-integration-tests","permalink":"/gosoline/how-to/write-integration-tests","draft":false,"unlisted":false,"editUrl":"https://github.com/justtrackio/gosoline/tree/main/docs/docs/how-to/write-integration-tests.mdx","tags":[],"version":"current","frontMatter":{"title":"Write integration tests"},"sidebar":"docSidebar","previous":{"title":"Implement health checks","permalink":"/gosoline/how-to/write-health-checks"},"next":{"title":"Reference","permalink":"/gosoline/category/reference"}}');var i=n(4848),r=n(8453),o=n(2754),a=n(7018);const c={title:"Write integration tests"},l=void 0,d={},u=[{value:"Base test case",id:"base-test-case",level:3},{value:"Application test case",id:"application-test-case",level:3},{value:"Httpserver test case",id:"httpserver-test-case",level:3},{value:"Httpserver extended test case",id:"httpserver-extended-test-case",level:3},{value:"Stream test case",id:"stream-test-case",level:3},{value:"Subscriber test case",id:"subscriber-test-case",level:3},{value:"Container expiry and cleanup",id:"container-expiry-and-cleanup",level:2},{value:"External Dependencies",id:"external-dependencies",level:2},{value:"Auto detect components",id:"auto-detect-components",level:3},{value:"Example",id:"example",level:4},{value:"Using external container instances",id:"using-external-container-instances",level:3},{value:"Shared environment",id:"shared-environment",level:3}];function h(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["In this section we will be looking at several types of integration tests provided by Gosoline. All of them can be used together in the same test, and Gosoline's ",(0,i.jsx)(t.code,{children:"suite"})," package is responsible for reading their configuration, starting and running an application, then running the actual tests cases. Below is their description:"]}),"\n",(0,i.jsx)(t.h3,{id:"base-test-case",children:"Base test case"}),"\n",(0,i.jsxs)(t.p,{children:["This is the simplest type of Gosoline test case. All it needs is a suite object having a method that starts with ",(0,i.jsx)(t.code,{children:"Test"}),", which has no inputs nor outputs. An example can be found in ",(0,i.jsx)(t.code,{children:"more_details/stream-consumer"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'func (s *ConsumerTestSuite) TestComponents() {\n\ts3 := s.Env().Component("s3", "default")\n\ts.NotNil(s3)\n\n\tstreamInput := s.Env().Component("streamInput", "consumerInput")\n\ts.NotNil(streamInput)\n\n\tstreamOutput := s.Env().Component("streamOutput", "publisher-outputEvent")\n\ts.NotNil(streamOutput)\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["This particular test makes use of ",(0,i.jsx)(t.em,{children:"suite.Suite"}),"'s methods to get and check if three components have been wired."]}),"\n",(0,i.jsx)(t.h3,{id:"application-test-case",children:"Application test case"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.em,{children:"Application"})," test cases are just like ",(0,i.jsx)(t.em,{children:"Base"})," test cases, the only difference being that they make use of an ",(0,i.jsx)(t.em,{children:"suite.AppUnderTest"})," object. An example can be found in the same file:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'func (s *ConsumerTestSuite) TestSuccessTwice(app suite.AppUnderTest) {\n\tconsumer := s.Env().StreamInput("consumerInput")\n\ts.NotNil(consumer)\n\n\tconsumer.Publish(mdl.Box(uint(2)), nil)\n\tconsumer.Publish(mdl.Box(uint(3)), nil)\n\n\tapp.Stop()\n\tapp.WaitDone()\n\n\tvar result int\n\ts.Env().StreamOutput("publisher-outputEvent").Unmarshal(0, &result)\n\ts.Equal(3, result)\n\n\ts.Env().StreamOutput("publisher-outputEvent").Unmarshal(1, &result)\n\ts.Equal(4, result)\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"This test publishes two items into the application's stream input, waits until the application is done, then reads its outputs, and compares them with their expected values."}),"\n",(0,i.jsx)(t.h3,{id:"httpserver-test-case",children:"Httpserver test case"}),"\n",(0,i.jsxs)(t.p,{children:["If you want to make a standard API call and read the response, you can use Gosoline's ",(0,i.jsx)(t.em,{children:"HttpserverTestCase"}),". This type of test issues HTTP calls and compares its responses against predefined values and structures. Here's an example:"]}),"\n",(0,i.jsx)(o.N,{title:"server_test.go",language:"go",snippet:"test euro",children:a.A}),"\n",(0,i.jsxs)(t.p,{children:["Notice the predefined structure of an ",(0,i.jsx)(t.code,{children:"HttpserverTestCase"}),": it is an object that has fields for all the information needed in performing an HTTP call, the expected status code, and a method that tests the result for correctness."]}),"\n",(0,i.jsxs)(t.p,{children:["In the example from our ",(0,i.jsx)(t.a,{href:"/quickstart/testing/test-your-http-server",children:"HTTP server test tutorial"})," we see two types of test cases (",(0,i.jsx)(t.em,{children:"Httpserver"})," and ",(0,i.jsx)(t.em,{children:"Httpserver extended"}),") in the same test suite. In fact, all types of tests can be part of the same test suite."]}),"\n",(0,i.jsx)(t.h3,{id:"httpserver-extended-test-case",children:"Httpserver extended test case"}),"\n",(0,i.jsxs)(t.p,{children:["In the ",(0,i.jsx)(t.a,{href:"/quickstart/testing/test-your-http-server",children:"Test your HTTP server"})," example, we saw the following test:"]}),"\n",(0,i.jsx)(o.N,{title:"server_test.go",language:"go",snippet:"test to euro",children:a.A}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"Test_ToEuro"})," method makes a GET call to an endpoint, in order to receive back the euro exchange value for 10 GBP. Lastly, it checks if the received value is 8.0."]}),"\n",(0,i.jsxs)(t.p,{children:["In order to make this GET call ",(0,i.jsx)(t.code,{children:"Test_ToEuro"})," does not need to concern itself about the IP on which the exchange application is running, nor its port. All ",(0,i.jsx)(t.code,{children:"Test_ToEuro"})," needs to know is the URL path of that endpoint, as the ",(0,i.jsx)(t.em,{children:"client"})," object does the rest."]}),"\n",(0,i.jsxs)(t.p,{children:["This ",(0,i.jsx)(t.em,{children:"client"})," object is provided by Gosoline, whenever at least one of a test suite's methods has the above signature. The main advantage of the ",(0,i.jsx)(t.em,{children:"client"})," object is that it allows you to control when requests are executed, and gives you access to the endpoint, by providing the host and port. Therefore, for example, if you want to time your requests, this is the way to go."]}),"\n",(0,i.jsx)(o.N,{title:"server_test.go",language:"go",snippet:"set up api defs",children:a.A}),"\n",(0,i.jsxs)(t.p,{children:["Implementing ",(0,i.jsx)(t.em,{children:"SetupApiDefinitions"})," when configuring your test will inform Gosoline that an API is being tested, thus the ",(0,i.jsx)(t.em,{children:"client"})," object will contain meaningful data."]}),"\n",(0,i.jsxs)(t.p,{children:["Forgetting to implement ",(0,i.jsx)(t.em,{children:"SetupApiDefinitions"}),", and the trying to run an ",(0,i.jsx)(t.em,{children:"Httpserver"}),", or an ",(0,i.jsx)(t.em,{children:"Httpserver extended"})," test case, will result in an error reminding you that ",(0,i.jsx)(t.code,{children:"the suite has to implement the TestingSuiteApiDefinitionsAware interface"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"stream-test-case",children:"Stream test case"}),"\n",(0,i.jsx)(t.p,{children:"If you have a Gosoline application that takes its input from a stream, you need a test which can run your application locally, send data to a stream, and check your application's output for correctness."}),"\n",(0,i.jsxs)(t.p,{children:["The stream-consumer application, found in ",(0,i.jsx)(t.code,{children:"more_details/stream-consumer"}),", reads unsigned integers from the ",(0,i.jsx)(t.code,{children:"consumerInput"})," input, increments them by one, and publishes them to the ",(0,i.jsx)(t.code,{children:"publisher-outputEvent"})," output. Below is an extract from its integration test:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'func (s *ConsumerTestSuite) SetupSuite() []suite.Option {\n\treturn []suite.Option{\n\t\tsuite.WithLogLevel("debug"),\n\t\tsuite.WithConfigFile("../stream-consumer/config.dist.yml"),\n\t\tsuite.WithModule("consumerModule", stream.NewConsumer("uintConsumer", consumer.NewConsumer())),\n\t}\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["It is making use of the same ",(0,i.jsx)(t.code,{children:"config.dist.yml"})," file as ",(0,i.jsx)(t.code,{children:"stream-consumer"}),", and it will be using the module created by ",(0,i.jsx)(t.em,{children:"consumer.NewConsumer"}),". A ",(0,i.jsx)(t.code,{children:"StreamTestCase"})," is very similar to an ",(0,i.jsx)(t.code,{children:"HttpserverTestCase"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'func (s *ConsumerTestSuite) TestSuccess() *suite.StreamTestCase {\n\treturn &suite.StreamTestCase{\n\t\tInput: map[string][]suite.StreamTestCaseInput{\n\t\t\t"consumerInput": {\n\t\t\t\t{\n\t\t\t\t\tAttributes: nil,\n\t\t\t\t\tBody:       mdl.Box(uint(5)),\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tAssert: func() error {\n\t\t\tvar result int\n\t\t\ts.Env().StreamOutput("publisher-outputEvent").Unmarshal(0, &result)\n\n\t\t\ts.Equal(6, result)\n\n\t\t\treturn nil\n\t\t},\n\t}\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["This ",(0,i.jsx)(t.code,{children:"StreamTestCase"})," is an object defining an input and an ",(0,i.jsx)(t.code,{children:"Assert"})," function. Gosoline will run the module, use this ",(0,i.jsx)(t.code,{children:"StreamTestCaseInput"})," as input for it, then run ",(0,i.jsx)(t.code,{children:"Assert"}),". The ",(0,i.jsx)(t.code,{children:"Assert"})," function reads the first element from a stream, ",(0,i.jsx)(t.em,{children:"publisher-outputEvent"}),", then compares it with an expected result. Notice that the input has a key called ",(0,i.jsx)(t.code,{children:"consumerInput"}),", because in this application's ",(0,i.jsx)(t.code,{children:"config.dist.yml"})," file, we have configured an input named ",(0,i.jsx)(t.code,{children:"consumerInput"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["Notice how the stream output object was obtained: ",(0,i.jsx)(t.code,{children:'s.Env().StreamOutput("publisher-outputEvent")'}),". In a similar manner, Gosoline's ",(0,i.jsx)(t.em,{children:"suite.Suite"})," object can provide other useful components: ",(0,i.jsx)(t.code,{children:'s.Env().DynamoDb("default").Client()'}),", ",(0,i.jsx)(t.code,{children:'s.Env().MySql("default").'}),", ",(0,i.jsx)(t.code,{children:'s.Env().Redis("default").Client()'}),", etc."]}),"\n",(0,i.jsx)(t.h3,{id:"subscriber-test-case",children:"Subscriber test case"}),"\n",(0,i.jsxs)(t.p,{children:["The subscriber test case is similar to a ",(0,i.jsx)(t.em,{children:"StreamTestCase"}),". It needs a methods whose name starts with ",(0,i.jsx)(t.code,{children:"Test"}),", has a ",(0,i.jsx)(t.em,{children:"suite.Suite"})," receiver, and returns an ",(0,i.jsx)(t.code,{children:"suite.SubscriberTestCase"})," and an error."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:'func (s *SubscriberTestSuite) TestSuccess() (suite.SubscriberTestCase, error) {\n\treturn suite.DdbTestCase(suite.DdbSubscriberTestCase{\n\t\tName:          "client",\n\t\tSourceModelId: "mcoins.marketing.management.client",\n\t\tTargetModelId: "mcoins.marketing.terminal-affiliate-click.client",\n\t\tInput: &terminal_affiliate_click.ClientInputV0{\n\t\t\tId: 42,\n\t\t\tStoreId:   "my.store.id",\n\t\t},\n\t\tAssert: func(t *testing.T, fetcher *suite.DdbSubscriberFetcher) {\n\t\t\tactual := &terminal_affiliate_click.Client{}\n\t\t\tfetcher.ByHash(uint(42), actual)\n\n\t\t\texpected := &terminal_affiliate_click.Client{\n\t\t\t\tId:        42,\n\t\t\t\tStoreId:   "my.store.id",\n\t\t\t}\n\n\t\t\ts.Equal(expected, actual)\n\t\t},\n\t})\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"This test will publish an item to an input, stops the application and waits for it to finish, then looks inside a ddd table to see if it was written there."}),"\n",(0,i.jsx)(t.h2,{id:"container-expiry-and-cleanup",children:"Container expiry and cleanup"}),"\n",(0,i.jsx)(t.p,{children:"When Gosoline's test environment starts Docker containers (e.g. Localstack, Kafka, MySQL), it also configures an automatic expiry to ensure resources are cleaned up even if a test crashes."}),"\n",(0,i.jsxs)(t.p,{children:["By default, containers are configured to expire after ",(0,i.jsx)(t.code,{children:"5m"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"test:\n  container_manager:\n    runner_type: local\n    name_prefix: goso\n    expire_after: 5m  # default\n"})}),"\n",(0,i.jsxs)(t.p,{children:["You can override this per suite using ",(0,i.jsx)(t.code,{children:"WithContainerExpireAfter"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-go",children:"func (s *MySuite) SetupSuite() []suite.Option {\n    return []suite.Option{\n        // keep containers alive for up to 30 minutes\n        suite.WithContainerExpireAfter(30 * time.Minute),\n    }\n}\n"})}),"\n",(0,i.jsx)(t.p,{children:"Or globally via your configuration:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"test:\n  container_manager:\n    expire_after: 30m\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The value is a Go duration string (e.g. ",(0,i.jsx)(t.code,{children:"30s"}),", ",(0,i.jsx)(t.code,{children:"5m"}),", ",(0,i.jsx)(t.code,{children:"1h"}),"). The test environment will still stop containers normally when the test finishes; ",(0,i.jsx)(t.code,{children:"expire_after"})," is a safety net to avoid orphaned containers."]}),"\n",(0,i.jsx)(t.h2,{id:"external-dependencies",children:"External Dependencies"}),"\n",(0,i.jsxs)(t.p,{children:["The test suite supports configuring and launching external dependencies as docker containers via its environment component.\nAn overview over supported can be found inside the ",(0,i.jsx)(t.code,{children:"test/env"})," module."]}),"\n",(0,i.jsx)(t.h3,{id:"auto-detect-components",children:"Auto detect components"}),"\n",(0,i.jsxs)(t.p,{children:["Another option each ",(0,i.jsx)(t.em,{children:"suite"})," test offers is ",(0,i.jsx)(t.code,{children:"WithoutAutoDetectedComponents"}),". This simply adds one extra options to the test, which tells it to skip one of the components configured in any potential ",(0,i.jsx)(t.code,{children:"config.dist.yml"}),". The skipped component's name is given as a parameter to ",(0,i.jsx)(t.code,{children:"WithoutAutoDetectedComponents"}),". Also note that while a component can be skipped by auto detect, it can still be added manually to the test via an option."]}),"\n",(0,i.jsx)(t.h4,{id:"example",children:"Example"}),"\n",(0,i.jsxs)(t.p,{children:["The suite environment tries to detect the component containers to launch automatically based on the resolved configuration.\nE.g., if you specify the ",(0,i.jsx)(t.code,{children:"db"})," key with driver ",(0,i.jsx)(t.code,{children:"mysql"}),", it will add a MySQL database to the launching components. You can disable this behaviour by setting ",(0,i.jsx)(t.code,{children:"test.auto_detect.enabled"})," to ",(0,i.jsx)(t.code,{children:"false"}),".\nWith disabled auto-detection, your test bed can look like this:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yml",children:"test:\n  auto_detect:\n    enabled: false\n  components:\n    ddb:\n      default:\n    mysql:\n      default:\n"})}),"\n",(0,i.jsx)(t.p,{children:"We define two components of type ddb (for DynamoDB) and mysql (for a MySQL server)."}),"\n",(0,i.jsx)(t.h3,{id:"using-external-container-instances",children:"Using external container instances"}),"\n",(0,i.jsxs)(t.p,{children:["When booting a container takes some time, or you want to preconfigure it, it can be beneficial to fallback to a already running container instance.\nFor this, you need to specify the option ",(0,i.jsx)(t.code,{children:"use_external_container"})," on your component configuration, and provide connection details if they differ from the defaults. Depending on the container runtime, you need to pass host ips and ports explicitly (e.g. for docker, the IP of the bridge gateway as host)."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yml",children:"test:\n  components:\n    mysql:\n      default:\n        use_external_container: true\n        host: 127.0.0.1\n        port: 3306\n"})}),"\n",(0,i.jsxs)(t.p,{children:["You can find a complete example inside ",(0,i.jsx)(t.code,{children:"examples/integration"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"shared-environment",children:"Shared environment"}),"\n",(0,i.jsxs)(t.p,{children:["One of the options for a Gosoline ",(0,i.jsx)(t.em,{children:"suite"})," integration test is ",(0,i.jsx)(t.code,{children:"suite.WithSharedEnvironment()"}),".\nWhen this option is off, each test case will run in its own environment.\nFor example, the fixtures are being loaded for every test case, and any change to a database or stream will only last during that test case alone.\nWhen this option is enabled, the environment is created only once and used by all the test cases, and any change done by one test case will be available to the ones who follow."]})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},7018(e,t,n){n.d(t,{A:()=>s});const s='//go:build integration && fixtures\n\n// snippet-start: imports\npackage apitest\n\nimport (\n\t"net/http"\n\t"strconv"\n\t"testing"\n\t"time"\n\n\t"github.com/go-resty/resty/v2"\n\t"github.com/justtrackio/gosoline/pkg/clock"\n\t"github.com/justtrackio/gosoline/pkg/httpserver"\n\t"github.com/justtrackio/gosoline/pkg/test/suite"\n)\n\n// snippet-end: imports\n\n// snippet-start: test suite\ntype HttpTestSuite struct {\n\tsuite.Suite\n\n\tclock clock.Clock\n}\n\n// snippet-end: test suite\n\n// snippet-start: set up suite\nfunc (s *HttpTestSuite) SetupSuite() []suite.Option {\n\treturn []suite.Option{\n\t\t// A hard-coded log level.\n\t\tsuite.WithLogLevel("info"),\n\n\t\t// Configurations from a config file.\n\t\tsuite.WithConfigFile("./config.dist.yml"),\n\n\t\t// The fixture set you created in the last section.\n\t\tsuite.WithFixtureSetFactory(fixtureSetsFactory),\n\n\t\t// suite.WithClockProvider(s.clock),\n\t\tsuite.WithClockProvider(s.clock),\n\t}\n}\n\n// snippet-end: set up suite\n\n// snippet-start: set up api defs\nfunc (s *HttpTestSuite) SetupApiDefinitions() httpserver.Definer {\n\treturn ApiDefiner\n}\n\n// snippet-end: set up api defs\n\n// snippet-start: test to euro\nfunc (s *HttpTestSuite) Test_ToEuro(_ suite.AppUnderTest, client *resty.Client) error {\n\tvar result float64\n\n\t// Make a GET request to /euro/:amount/:currency where :amount = 10 and :currency = GBP\n\tresponse, err := client.R().\n\t\tSetResult(&result).\n\t\tExecute(http.MethodGet, "/euro/10/GBP")\n\n\t// Check that there is no error.\n\ts.NoError(err)\n\n\t// Check that the response status code is 200 OK.\n\ts.Equal(http.StatusOK, response.StatusCode())\n\n\t// Check that the converted amount is 8.0.\n\ts.Equal(8.0, result)\n\n\treturn nil\n}\n\n// snippet-end: test to euro\n\n// snippet-start: test-toeuroatdate\nfunc (s *HttpTestSuite) Test_ToEuroAtDate(_ suite.AppUnderTest, client *resty.Client) error {\n\tvar result float64\n\n\tresponse, err := client.R().\n\t\tSetResult(&result).\n\t\tExecute(http.MethodGet, "/euro-at-date/10/GBP/2021-01-03T00:00:00Z")\n\n\ts.NoError(err)\n\ts.Equal(http.StatusOK, response.StatusCode())\n\ts.Equal(12.5, result)\n\n\treturn nil\n}\n\n// snippet-end: test-toeuroatdate\n\n// snippet-start: test euro\nfunc (s *HttpTestSuite) Test_Euro() *suite.HttpserverTestCase {\n\treturn &suite.HttpserverTestCase{\n\t\tMethod:             http.MethodGet,\n\t\tUrl:                "/euro/10/GBP",\n\t\tHeaders:            map[string]string{},\n\t\tExpectedStatusCode: http.StatusOK,\n\t\tAssert: func(response *resty.Response) error {\n\t\t\tresult, err := strconv.ParseFloat(string(response.Body()), 64)\n\t\t\ts.NoError(err)\n\t\t\ts.Equal(8.0, result)\n\n\t\t\treturn nil\n\t\t},\n\t}\n}\n\n// snippet-end: test euro\n\n// snippet-start: unit test\nfunc TestHttpTestSuite(t *testing.T) {\n\tsuite.Run(t, &HttpTestSuite{\n\t\tclock: clock.NewFakeClockAt(time.Now().UTC()),\n\t})\n}\n\n// snippet-end: unit test\n'}}]);