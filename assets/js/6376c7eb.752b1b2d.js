"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[1214],{4340(e,n,s){s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"reference/package-cloud_aws","title":"Package cloud/aws","description":"The cloud/aws package","source":"@site/docs/reference/package-cloud_aws.mdx","sourceDirName":"reference","slug":"/reference/package-cloud_aws","permalink":"/gosoline/reference/package-cloud_aws","draft":false,"unlisted":false,"editUrl":"https://github.com/justtrackio/gosoline/tree/main/docs/docs/reference/package-cloud_aws.mdx","tags":[],"version":"current","frontMatter":{"title":"Package cloud/aws"},"sidebar":"docSidebar","previous":{"title":"Package cfg","permalink":"/gosoline/reference/package-cfg"},"next":{"title":"Package dbx","permalink":"/gosoline/reference/package-dbx"}}');var c=s(4848),l=s(8453);const i={title:"Package cloud/aws"},d=void 0,r={},a=[{value:"The cloud/aws package",id:"the-cloudaws-package",level:2},{value:"Configuration",id:"configuration",level:2},{value:"General service config",id:"general-service-config",level:3},{value:"Cloudwatch",id:"cloudwatch",level:3},{value:"Different Client Names",id:"different-client-names",level:3},{value:"Full reference",id:"full-reference",level:3}];function o(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h2,{id:"the-cloudaws-package",children:"The cloud/aws package"}),"\n",(0,c.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,c.jsx)(n.p,{children:"The AWS SDK v2 based services use the following default settings for region\nand endpoint, meaning you get those values for every requested client if you\ndon't specify anything else for the client."}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'cloud:\n  aws:\n    defaults:\n      region: "eu-central-1"\n      endpoint: "http://localhost:4566" #localstack\n'})}),"\n",(0,c.jsx)(n.h3,{id:"general-service-config",children:"General service config"}),"\n",(0,c.jsx)(n.p,{children:"AWS service clients are created and configured by name. The pattern here is:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-golang",children:"func ProvideClient(ctx context.Context, config cfg.Config, logger log.Logger, name string, optFns ...func(options *awsCfg.LoadOptions) error) (*serviceX.Client, error)\n"})}),"\n",(0,c.jsx)(n.p,{children:"The resulting client can be configured by:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'cloud:\n    aws:\n        serviceX:\n            clients:\n                default: # name of the client\n                    assume_role: ""\n                    backoff:\n                        cancel_delay: 0s\n                        initial_interval: 50ms\n                        max_attempts: 10\n                        max_elapsed_time: 10m0s\n                        max_interval: 10s\n                    credentials:\n                        access_key_id: justtrack\n                        secret_access_key: justtrack\n                        session_token: ""\n                    credentials_cache:\n                        expiry_window: 5m\n                        expiry_window_jitter_frac: 0.1\n                    endpoint: http://localhost:4566\n                    http_client:\n                        timeout: 0s\n                    profile: ""\n                    region: eu-central-1\n\n'})}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"Setting"}),(0,c.jsx)(n.th,{children:"Description"}),(0,c.jsx)(n.th,{children:"Default"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"assume_role"}),(0,c.jsx)(n.td,{children:"If defined, this role will be used to gain access"}),(0,c.jsx)(n.td,{children:'""'})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"backoff.cancel_delay"}),(0,c.jsx)(n.td,{children:"If the request get canceled, how long should the cancel delayed"}),(0,c.jsx)(n.td,{children:"1s"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"backoff.initial_interval"}),(0,c.jsx)(n.td,{children:"The initial duration to wait before retrying the request on error"}),(0,c.jsx)(n.td,{children:"50ms"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"backoff.max_attempts"}),(0,c.jsx)(n.td,{children:"How many attempts should be done"}),(0,c.jsx)(n.td,{children:"10 (0 means retry forever)"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"backoff.max_interval"}),(0,c.jsx)(n.td,{children:"Max duration between 2 calls when retrying"}),(0,c.jsx)(n.td,{children:"10s"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"backoff.max_elapsed_time"}),(0,c.jsx)(n.td,{children:"For how long the service should retry the request"}),(0,c.jsx)(n.td,{children:"10m (0m means retry forever)"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"credentials_cache.expiry_window"}),(0,c.jsx)(n.td,{children:"The duration before cached credentials expire"}),(0,c.jsx)(n.td,{children:"5m"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"credentials_cache.expiry_window_jitter_frac"}),(0,c.jsx)(n.td,{children:"The fraction of the expiry window to use as jitter"}),(0,c.jsx)(n.td,{children:"0.1"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"endpoint"}),(0,c.jsx)(n.td,{children:"Which service endpoint should be called"}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.a,{href:"http://localhost:4566",children:"http://localhost:4566"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"http_client.timeout"}),(0,c.jsx)(n.td,{children:"After what duration the request should be canceled, if the server doesn't respond"}),(0,c.jsx)(n.td,{children:"0s (no timeout)"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"profile"}),(0,c.jsx)(n.td,{children:"If defined, this aws profile will be used to fetch credentials"}),(0,c.jsx)(n.td,{children:'""'})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"region"}),(0,c.jsx)(n.td,{children:"The region in use"}),(0,c.jsx)(n.td,{children:"eu-central-1"})]})]})]}),"\n",(0,c.jsx)(n.h3,{id:"cloudwatch",children:"Cloudwatch"}),"\n",(0,c.jsx)(n.p,{children:"Call"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-golang",children:'import(\n    gosoCloudwatch "github.com/justtrackio/gosoline/pkg/cloud/aws/cloudwatch"\n)\n\ncloudwatchClient := gosoCloudwatch.ProvideClient(ctx, config, logger , "default")\n'})}),"\n",(0,c.jsx)(n.p,{children:"to get the default cloudwatch client. You don't have to provide any config\nif you want to go with the default settings. The default settings are:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'cloud:\n    aws:\n        cloudwatch:\n            clients:\n                default:\n                    assume_role: ""\n                    backoff:\n                        cancel_delay: 0s\n                        initial_interval: 50ms\n                        max_attempts: 10\n                        max_elapsed_time: 10m0s\n                        max_interval: 10s\n                    credentials:\n                        access_key_id: justtrack\n                        secret_access_key: justtrack\n                        session_token: ""\n                    credentials_cache:\n                        expiry_window: 5m\n                        expiry_window_jitter_frac: 0.1\n                    endpoint: http://localhost:4566\n                    http_client:\n                        timeout: 0s\n                    profile: ""\n                    region: eu-central-1\n\n'})}),"\n",(0,c.jsx)(n.p,{children:"These are the default values which are used if you don't provide any config by yourself."}),"\n",(0,c.jsx)(n.h3,{id:"different-client-names",children:"Different Client Names"}),"\n",(0,c.jsx)(n.p,{children:"You can specify different client names to customize specific fields for a\nparticular client while inheriting the rest of the configuration. For example:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'cloud:\n  aws:\n    dynamodb:\n      clients:\n        someClientName:\n          naming:\n            pattern: "{env}-{group}-{modelId}"\n'})}),"\n",(0,c.jsxs)(n.p,{children:["The configuration for a specific client name (e.g., ",(0,c.jsx)(n.code,{children:"someClientName"}),") is resolved by merging settings in the following order of precedence:"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Client-specific settings for the given service"})," (e.g., ",(0,c.jsx)(n.code,{children:"cloud.aws.dynamodb.clients.someClientName"}),")"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Client-specific settings from the defaults"})," (e.g., ",(0,c.jsx)(n.code,{children:"cloud.aws.defaults.clients.someClientName"}),")"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Service-wide default settings for the given service"})," (e.g., ",(0,c.jsx)(n.code,{children:"cloud.aws.dynamodb.clients.default"}),")"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Global defaults for all clients"})," (e.g., ",(0,c.jsx)(n.code,{children:"cloud.aws.defaults.clients.default"}),")"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Global defaults for all AWS clients"})," (e.g., ",(0,c.jsx)(n.code,{children:"cloud.aws.defaults"}),")"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"For example, if you specify:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'cloud:\n  aws:\n    defaults:\n      region: "eu-west-1"\n      credentials:\n        access_key_id: "default-access-key"\n        secret_access_key: "default-secret"\n      clients:\n        default:\n          region: "eu-west-2"\n        clientWithoutEnvInName:\n          backoff:\n            type: infinite\n    dynamodb:\n      clients:\n        default:\n          region: "eu-central-1"\n          naming:\n            pattern: "{env}-{group}-{modelId}"\n        clientWithoutEnvInName:\n          naming:\n            pattern: "{group}-{modelId}"\n    sqs:\n      clients:\n        clientWithoutEnvInName:\n          naming:\n            pattern: "{group}-{queueId}"\n'})}),"\n",(0,c.jsxs)(n.p,{children:["Then, the dynamodb client ",(0,c.jsx)(n.code,{children:"clientWithoutEnvInName"})," will use:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"region"})}),": ",(0,c.jsx)(n.code,{children:"eu-central-1"})," (from ",(0,c.jsx)(n.code,{children:"cloud.aws.dynamodb.clients.default"})," since ",(0,c.jsx)(n.code,{children:"region"})," is not explicitly set for ",(0,c.jsx)(n.code,{children:"clientWithoutEnvInName"}),")."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"naming.pattern"})}),": ",(0,c.jsx)(n.code,{children:"{group}-{modelId}"})," (from ",(0,c.jsx)(n.code,{children:"cloud.aws.dynamodb.clients.clientWithoutEnvInName"}),")."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"credentials"})}),": ",(0,c.jsx)(n.code,{children:"default-access-key"})," and ",(0,c.jsx)(n.code,{children:"default-secret"})," (from ",(0,c.jsx)(n.code,{children:"cloud.aws.defaults"}),")."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"backoff.type"})}),": ",(0,c.jsx)(n.code,{children:"infinite"})," (from ",(0,c.jsx)(n.code,{children:"cloud.aws.defaults.clientWithoutEnvInName"}),")."]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["The sqs client ",(0,c.jsx)(n.code,{children:"clientWithoutEnvInName"})," will use:"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"region"})}),": ",(0,c.jsx)(n.code,{children:"eu-west-2"})," (from ",(0,c.jsx)(n.code,{children:"cloud.aws.defaults.clients.default"})," since ",(0,c.jsx)(n.code,{children:"region"})," is not explicitly set for ",(0,c.jsx)(n.code,{children:"clientWithoutEnvInName"}),")."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"naming.pattern"})}),": ",(0,c.jsx)(n.code,{children:"{group}-{queueId}"})," (from ",(0,c.jsx)(n.code,{children:"cloud.aws.sqs.clients.clientWithoutEnvInName"}),")."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"credentials"})}),": ",(0,c.jsx)(n.code,{children:"default-access-key"})," and ",(0,c.jsx)(n.code,{children:"default-secret"})," (from ",(0,c.jsx)(n.code,{children:"cloud.aws.defaults"}),")."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"backoff.type"})}),": ",(0,c.jsx)(n.code,{children:"infinite"})," (from ",(0,c.jsx)(n.code,{children:"cloud.aws.defaults.clientWithoutEnvInName"}),")."]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"full-reference",children:"Full reference"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-yaml",children:'cloud:\n  aws:\n    defaults:\n      assume_role: "arn:aws:iam::123456789012:role/gosoline-test-role"\n      credentials:\n        access_key_id: "justtrack"\n        secret_access_key: "justtrack"\n        session_token: "justtrack"\n      credentials_cache:\n        expiry_window: 5m\n        expiry_window_jitter_frac: 0.1\n      profile: "sdlc-dev-account"\n      endpoint: "http://localhost:4566"\n      region: "eu-central-1"\n    cloudwatch:\n      clients:\n        default:\n          assume_role: "arn:aws:iam::123456789012:role/gosoline-test-role"\n          credentials:\n            access_key_id: "justtrack"\n            secret_access_key: "justtrack"\n            session_token: "justtrack"\n          profile: "sdlc-dev-account"\n          endpoint: "http://localhost:4566"\n          region: "eu-central-1"\n          http_client:\n            timeout: 0s\n          backoff:\n            cancel_delay: 1s\n            initial_interval: 50ms\n            max_attempts: 10\n            max_elapsed_time: 15m0s\n            max_interval: 10s\n    dynamodb:\n      clients:\n        default:\n          naming:\n            pattern: "{env}-{group}-{modelId}"\n    kinesis:\n      clients:\n        default:\n          credentials:\n            access_key_id: "*******************"\n            secret_access_key: "****************************************"\n            session_token: "********************************************************************"\n    s3:\n      clients:\n        default:\n          usePathStyle: false\n          credentials:\n            endpoint: "https://s3.eu-central-1.amazonaws.com"\n    sqs:\n      clients:\n        default:\n          naming:\n            pattern: "{env}-{group}-{queueId}"\n'})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}}}]);