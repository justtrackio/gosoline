---
title: Package dbx
---

# dbx package

The dbx package provides a fluent API to build SQL queries.

## Client

The client is the main entry point to the package. It is used to create query builders.

### YourModel struct

```go
type YourModel struct {
    Id   int    `db:"id"`
    Name string `db:"name"`
}
```

### [NewClient()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/client.go)

#### Usage

```go
client, err := dbx.NewClient[YourModel](ctx, config, logger, "default", "your_table")
```

#### Description

Creates a new dbx client. You need to provide a model (a struct with `db` tags), which will be used to map the database table to your struct.

The `clientName` argument is the name of the database client to use, as configured in your application's configuration file.  
The `table` argument is the name of the database table.

## Query Builders

The dbx package provides query builders for SELECT, INSERT, UPDATE, DELETE, and GET statements.

### [Get()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/client.go)

#### Usage

```go
result, err := client.Get().Where(dbx.Eq{"id": 1}).Exec(ctx)
if errors.Is(err, dbx.ErrNotFound) {
    // handle not found
}
```
```sql
SELECT id, name FROM your_table WHERE id = 1 LIMIT 2
```

#### Description

Creates a new GET query builder. This is a convenience method that wraps `Select()` and returns a single element or an error.

**Return values:**
- Returns a single element of type `T` if exactly one row is found
- Returns `dbx.ErrNotFound` if no rows match the query
- Returns an error if more than one row is found

The `Get` builder automatically adds `LIMIT 2` to detect when multiple rows match the query.

You can also pass a struct of type `T` to the `Where` clause:

```go
result, err := client.Get().Where(YourModel{Id: 1}).Exec(ctx)
```
```sql
SELECT id, name FROM your_table WHERE id = 1 LIMIT 2
```

The `Get` builder supports the same methods as the `Select` builder, including `Join`, `OrderBy`, `GroupBy`, and `Having`.

**Advanced Usage:**

```go
// Get with JOIN
result, err := client.Get().
    Join("profiles p ON your_table.id = p.user_id").
    Where(dbx.Eq{"p.verified": true}).
    Exec(ctx)

// Get with ORDER BY (returns first match after ordering)
result, err := client.Get().
    Where(dbx.Eq{"status": "active"}).
    OrderBy("created_at DESC").
    Exec(ctx)
```

### [Select()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/client.go)

#### Usage

```go
results, err := client.Select().Where(dbx.Eq{"id": 1}).Exec(ctx)
```
```sql
SELECT id, name FROM your_table WHERE id = 1
```

#### Description

Creates a new SELECT query builder. You can use the `Where` method to add conditions to your query. The `Exec` method executes the query and returns the results.

You can also pass a struct of type `T` to the `Where` clause. In this case, the struct will be converted to a map and the non-zero fields will be used to build an `Eq` expression.
This is available for all query builders, not just `Select`.

```go
results, err := client.Select().Where(YourModel{Id: 1}).Exec(ctx)
```
```sql
SELECT id, name FROM your_table WHERE id = 1
```

### [Insert()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/client.go)

#### Usage

##### Single Insert
```go
_, err := client.Insert(YourModel{Id: 1, Name: "test"}).Exec(ctx)
```
```sql
INSERT INTO your_table (id,name) VALUES (1,'test')
```

##### Batch Insert
```go
_, err := client.Insert(
    YourModel{Id: 1, Name: "test1"},
    YourModel{Id: 2, Name: "test2"},
).Exec(ctx)
```
```sql
INSERT INTO your_table (id,name) VALUES (1,'test1'), (2,'test2');
```

#### Description

Creates a new INSERT query builder. You need to provide the model with the values to insert. You can also provide multiple models to insert multiple rows at once. The `Exec` method executes the query.

### [Replace()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/client.go)

#### Usage

```go
_, err := client.Replace(YourModel{Id: 1, Name: "test"}).Exec(ctx)
```
```sql
REPLACE INTO your_table (id,name) VALUES (1,'test')
```

#### Description

Creates a new REPLACE query builder. You need to provide the model with the values to insert. The `Exec` method executes the query.

### [Update()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/client.go)

#### Usage

```go
_, err := client.Update(map[string]any{"name": "new_name"}).Where(dbx.Eq{"id": 1}).Exec(ctx)
```
```sql
UPDATE your_table SET name = 'new_name' WHERE id = 1
```

#### Description

Creates a new UPDATE query builder. You can provide one or more maps with the new values, which will be merged together. You can use the `Where` method to add conditions to your query. The `Exec` method executes the query.

You can also pass a struct of type `T` to the `Update` method. In this case, the struct will be converted to a map and the non-zero fields will be used to build the `SET` clause of the query.

```go
_, err := client.Update(YourModel{Name: "new_name"}).Where(dbx.Eq{"id": 1}).Exec(ctx)
```
```sql
UPDATE your_table SET name = 'new_name' WHERE id = 1
```

### [Delete()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/client.go)

#### Usage

```go
_, err := client.Delete().Where(dbx.Eq{"id": 1}).Exec(ctx)
```
```sql
DELETE FROM your_table WHERE id = 1
```

#### Description

Creates a new DELETE query builder. You can use the `Where` method to add conditions to your query. The `Exec` method executes the query.

## Error Handling

### [ErrNotFound](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/client.go)

The `dbx.ErrNotFound` error is returned by the `Get()` method when no rows match the query. You can use `errors.Is()` to check for this error:

```go
result, err := client.Get().Where(dbx.Eq{"id": 1}).Exec(ctx)
if errors.Is(err, dbx.ErrNotFound) {
    // handle not found case
    return nil, fmt.Errorf("user not found")
}
if err != nil {
    // handle other errors
    return nil, err
}
// use result
```

## Query Builder Methods

The `Select` and `Get` builders provide the following methods to build complex queries. Note that `Get` automatically adds `LIMIT 2` to detect multiple results.

### [Distinct()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/select.go)

Adds a `DISTINCT` clause to the query.

```go
results, err := client.Select().Distinct().Exec(ctx)
```
```sql
SELECT DISTINCT id, name FROM your_table
```

### [Join()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/select.go)

Adds a `JOIN` clause to the query.

```go
results, err := client.Select().Join("other_table ON other_table.id = your_table.id").Exec(ctx)
```
```sql
SELECT id, name FROM your_table JOIN other_table ON other_table.id = your_table.id
```

You can also use `LeftJoin`, `RightJoin`, `InnerJoin` and `CrossJoin`.

### [GroupBy()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/select.go)

Adds a `GROUP BY` clause to the query.

```go
results, err := client.Select().GroupBy("name").Exec(ctx)
```
```sql
SELECT id, name FROM your_table GROUP BY name
```

### [Having()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/select.go)

Adds a `HAVING` clause to the query.

```go
results, err := client.Select().GroupBy("name").Having(dbx.Gt{"COUNT(id)": 1}).Exec(ctx)
```
```sql
SELECT id, name FROM your_table GROUP BY name HAVING COUNT(id) > 1
```

### [OrderBy()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/select.go)

Adds an `ORDER BY` clause to the query.

```go
results, err := client.Select().OrderBy("name DESC").Exec(ctx)
```
```sql
SELECT id, name FROM your_table ORDER BY name DESC
```

### [Limit()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/select.go)

Adds a `LIMIT` clause to the query.

```go
results, err := client.Select().Limit(10).Exec(ctx)
```
```sql
SELECT id, name FROM your_table LIMIT 10
```

### [Offset()](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/select.go)

Adds an `OFFSET` clause to the query.

```go
results, err := client.Select().Limit(10).Offset(10).Exec(ctx)
```
```sql
SELECT id, name FROM your_table LIMIT 10 OFFSET 10
```

## Expressions

The `Sqlizer` interface can be converted to SQL. There are many implementations of this interface.

### [Expr](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Builds an expression from a SQL fragment and arguments.

```go
client.Select().Where(dbx.Expr("FROM_UNIXTIME(?) > ?", 1672531200, 1000))
```
```sql
SELECT id, name FROM your_table WHERE FROM_UNIXTIME(1672531200) > 1000
```

### [ConcatExpr](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Builds an expression by concatenating strings and other expressions.

```go
client.Select().Column(dbx.ConcatExpr("COALESCE(full_name, ", dbx.Expr("CONCAT(?, ' ', ?)", "first", "last"), ")"))
```
```sql
SELECT COALESCE(full_name, CONCAT('first', ' ', 'last')) FROM your_table
```

### [Alias](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Allows to define an alias for a column.

```go
client.Select().Column(dbx.Alias(dbx.Expr("COUNT(*)"), "total"))
```
```sql
SELECT (COUNT(*)) AS total FROM your_table
```

### [Eq](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates an "equal" expression.

```go
client.Select().Where(dbx.Eq{"id": 1})
```
```sql
SELECT id, name FROM your_table WHERE id = 1
```

### [NotEq](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates a "not equal" expression.

```go
client.Select().Where(dbx.NotEq{"id": 1})
```
```sql
SELECT id, name FROM your_table WHERE id <> 1
```

### [Like](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates a "like" expression.

```go
client.Select().Where(dbx.Like{"name": "%test%"})
```
```sql
SELECT id, name FROM your_table WHERE name LIKE '%test%'
```

### [NotLike](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates a "not like" expression.

```go
client.Select().Where(dbx.NotLike{"name": "%test%"})
```
```sql
SELECT id, name FROM your_table WHERE name NOT LIKE '%test%'
```

### [ILike](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates a case-insensitive "like" expression.

```go
client.Select().Where(dbx.ILike{"name": "test%"})
```
```sql
SELECT id, name FROM your_table WHERE name ILIKE 'test%'
```

### [NotILike](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates a case-insensitive "not like" expression.

```go
client.Select().Where(dbx.NotILike{"name": "test%"})
```
```sql
SELECT id, name FROM your_table WHERE name NOT ILIKE 'test%'
```

### [Lt](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates a "less than" expression.

```go
client.Select().Where(dbx.Lt{"age": 18})
```
```sql
SELECT id, name FROM your_table WHERE age < 18
```

### [LtOrEq](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates a "less than or equal" expression.

```go
client.Select().Where(dbx.LtOrEq{"age": 18})
```
```sql
SELECT id, name FROM your_table WHERE age <= 18
```

### [Gt](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates a "greater than" expression.

```go
client.Select().Where(dbx.Gt{"age": 18})
```
```sql
SELECT id, name FROM your_table WHERE age > 18
```

### [GtOrEq](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates a "greater than or equal" expression.

```go
client.Select().Where(dbx.GtOrEq{"age": 18})
```
```sql
SELECT id, name FROM your_table WHERE age >= 18
```

### [And](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates an "and" conjunction of expressions.

```go
client.Select().Where(dbx.And(dbx.Eq{"id": 1}, dbx.Like{"name": "%test%"}))
```
```sql
SELECT id, name FROM your_table WHERE (id = 1 AND name LIKE '%test%')
```

### [Or](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/expr.go)

Creates an "or" conjunction of expressions.

```go
client.Select().Where(dbx.Or(dbx.Eq{"id": 1}, dbx.Eq{"id": 2}))
```
```sql
SELECT id, name FROM your_table WHERE (id = 1 OR id = 2)
```

## Placeholder Formats

The dbx package supports two placeholder formats: `Question` and `Dollar`. The default is `Question`. You can change the placeholder format by passing it to the `NewClientWithInterfaces` function.

### [Question](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/placeholder.go)

The `Question` format uses `?` as a placeholder.

### [Dollar](https://github.com/justtrackio/gosoline/blob/main/pkg/dbx/placeholder.go)

The `Dollar` format uses `$` as a placeholder.